========
比較機能
========

比較機能概要
==============

| 本書では、ITAの比較機能および操作方法について説明します。

比較機能について
^^^^^^^^^^^^^^^^

| 比較機能とは、ITAのパラメータシート作成機能で作成したパラメータシートを比較し、差分を出力する機能です。
|
| 本機能は、「パラメータシート（ホスト/オペレーションあり）」を対象としています。
| パラメータシートの詳細については、「:doc:`../create_param/menu_creation`」を参照してください。


比較機能全体概要図
******************


| 以下は、比較機能実行までの全体の概要図です。

.. figure:: /images/ja/menu_creation/comparison_function/overview_all.drawio.png
   :width: 6.67391in
   :height: 3.20028in
   :align: left
   :alt: 収集機能概要図

   収集機能概要図


比較機能処理概要図
******************

| 以下は、比較機能の処理の概要図です。
| 比較設定、比較詳細設定、実行時に指定する条件に従い、比較結果を出力します。

.. figure:: /images/ja/menu_creation/comparison_function/overview_process.drawio.png
   :width: 6.67391in
   :height: 3.20028in
   :align: left
   :alt: 比較機能処理概要図

   比較機能処理概要図


比較機能定義概要図
******************

| 以下は、パラメータシートの紐付と比較結果の概要図です。
| 比較設定、比較詳細設定、各設定については、「:ref:`about_how_to_use_compare`」を参照してください。
|
| ・パラメータシートの紐付（比較対象のパラメータシートの項目が一致している場合）

.. figure:: /images/ja/menu_creation/comparison_function/example_parameter_sheet_match.drawio.png
   :width: 6.67391in
   :height: 3.20028in
   :align: left
   :alt: 比較対象のパラメータシートの項目が一致している場合

   比較対象のパラメータシートの項目が一致している場合

|
| ・パラメータシートの紐付（比較対象のパラメータシートの項目が不一致の場合）

.. figure:: /images/ja/menu_creation/comparison_function/example_parameter_sheet_unmatch.drawio.png
   :width: 6.67391in
   :height: 3.20028in
   :align: left
   :alt: 比較対象のパラメータシートの項目が不一致の場合

   比較対象のパラメータシートの項目が不一致の場合


.. _about_base_datetime:

基準日時について
^^^^^^^^^^^^^^^^
| 基準日時とは、該当のオペレーションが過去に一度でも実行されたことがあれば「最終実行日時」、一度も実行されたことがなければ「実施予定日時」が「基準日時」となります。
| 基準日時については、「:doc:`../create_param/menu_creation`」を参照してください。

.. figure:: /images/ja/menu_creation/comparison_function/basedate.drawio.png
   :width: 6.67391in
   :height: 3.20028in
   :align: left
   :alt: 基準日時概要図

   基準日時概要図

.. tip::
        | 「参照用」メニューグループで、①～③の日時を基準日時とした検索をした場合の、検索結果の例です。
        | ① 1/1時点で、値は、何も設定されていない為、検索結果はありません。「なし」
        | ② 3/15時点で、オペレーション1に設定されている値が検索結果に表示されます。「パラメータA:100」
        | ③ 5/15時点で、オペレーション4に設定されている値が検索結果に表示されます。「パラメータA:200」




パラメータシートの比較について
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

| 比較機能は、比較設定、比較詳細設定にて、紐付された対象パラメータシートの項目情報を元に値の比較を実施します。
|

比較機能の実行要件
******************

| ITAで以下の設定がされている必要があります。

- | パラメータシート定義・作成にて、パラメータシート（ホスト/オペレーションあり）が作成されている。
- | 比較設定にて、比較対象となるパラメータシート同士の紐づけ設定がされている。
- | 比較詳細設定にて、比較対象とする項目同士で紐づけ設定がされている。

.. note::
          | 比較設定にて、詳細設定フラグが「True」設定時のみ、比較詳細設定について設定が可能です。
          | 比較するパラメータシートの項目数、項目名が一致している場合(詳細設定フラグが「False」)、比較詳細設定の設定は不要です。


比較実行パラメータ
******************

| 以下をパラメータとして設定し比較を実行できます。
| 比較設定については、後述の「:ref:`about_compare_list`」を参照。

.. figure:: /images/ja/menu_creation/comparison_function/compare_execute.png
   :width: 6.67391in
   :height: 3.20028in
   :align: left
   :alt: サブメニュー画面（比較実行）

   サブメニュー画面\(比較実行\)

.. list-table:: 比較実行パラメータ
   :header-rows: 1
   :align: left

   * - | パラメータ
     - | 説明
     - | 入力必須
     - | 入力形式
     - | 制約事項
   * - | 比較設定選択
     - | 比較設定を選択して下さい。
     - | ○
     - | リスト選択
     - |
   * - | 基準日時1
     - | 比較設定にて対象パラメータシート1 で選択したパラメータシートの
       | 基準となる日時を入力して下さい。
     - |
     - | 手動入力
     - | 入力しない場合、最新の基準日時が適応されます。
   * - | 基準日時2
     - | 比較設定にて対象パラメータシート2 で選択したパラメータシートの
       | 基準となる日時を入力して下さい。
     - |
     - | 手動入力
     - | 入力しない場合、最新の基準日時が適応されます。
   * - | ホスト選択
     - | 対象ホストを選択して下さい。
       | デフォルト：対象の絞り込みなし。（比較対象を全件表示）
     - |
     - | リスト選択
     - |


比較機能での対象項目について
============================

比較対象項目
^^^^^^^^^^^^

比較対象のパラメータシートの項目
********************************

| 比較機能で使用可能なパラメータシートの項目について以下となります。

.. list-table:: パラメータシートの比較対象項目
   :header-rows: 1
   :align: left

   * - | 項目種別
     - | 制約事項
   * - | 文字列\(単一行\)
     - |
   * - | 文字列\(複数行\)
     - |
   * - | 整数
     - |
   * - | 小数
     - |
   * - | 日時
     - |
   * - | 日付
     - |
   * - | プルダウン選択
     - | 選択したリストの値での比較を行います。
       | 参照先のレコードが廃止されている場合、 ID変換失敗\(X\)表記となります。
   * - | ファイルアップロード
     - | ファイルアップロード同士で比較する場合、ファイル名、ファイルの内容で比較を
       | 実施します。
   * - | リンク
     - |
   * - | パラメータシート参照
     - | 参照先のパラメータシートの値で比較を行います。
       | 参照先のレコードが廃止されている場合、 ID変換失敗\(X\)表記となります。

比較可能な対象項目の組み合わせ
************************************

| 比較可能なパラメータシートの項目の組み合わせ一覧になります。

.. list-table:: 比較対象項目の比較パターン組み合わせ
   :widths: 13 10 10 10 10 10 10 10 10 10 15
   :header-rows: 1
   :stub-columns: 1
   :align: left

   * - |
     - | 文字列
       | \(単一行\)
     - | 文字列
       | \(複数行\)
     - | 整数
     - | 小数
     - | 日時
     - | 日付
     - | プルダウン
       | 選択
     - | ファイル
       | アップロード
     - | リンク
     - | パラメータシート
       | 参照
   * - | 文字列
       | \(単一行\)
     - | ○
     - | ○
     - | ○
     - | ○
     - | ○
     - | ○
     - | ○
     - | ○※1
     - | ○
     - | ○
   * - | 文字列
       | \(複数行\)
     - | ○
     - | ○
     - | ○
     - | ○
     - | ○
     - | ○
     - | ○
     - | ○※1
     - | ○
     - | ○
   * - | 整数
     - | ○
     - | ○
     - | ○
     - | ○
     - | ○
     - | ○
     - | ○
     - | ○※1
     - | ○
     - | ○
   * - | 小数
     - | ○
     - | ○
     - | ○
     - | ○
     - | ○
     - | ○
     - | ○
     - | ○※1
     - | ○
     - | ○
   * - | プルダウン
       | 選択
     - | ○
     - | ○
     - | ○
     - | ○
     - | ○
     - | ○
     - | ○
     - | ○※1
     - | ○
     - | ○
   * - | ファイル
       | アップロード
     - | ○※1
     - | ○※1
     - | ○※1
     - | ○※1
     - | ○※1
     - | ○※1
     - | ○※1
     - | ○
     - | ○※1
     - | ○※1
   * - | リンク
     - | ○
     - | ○
     - | ○
     - | ○
     - | ○
     - | ○
     - | ○
     - | ○※1
     - | ○
     - | ○
   * - | パラメータシート
       | 参照
     - | ○
     - | ○
     - | ○
     - | ○
     - | ○
     - | ○
     - | ○
     - | ○※1
     - | ○
     - | ○

.. note::
          | ※1 ファイル名、ファイルの内容のどちらか片方で差分がある場合、差分ありとなります。ファイルアップロード以外の項目について、ファイルの内容は空扱いで比較します。


比較機能 メニュー構成
=====================

| 本章では、比較機能のメニュー構成について説明します。

メニュー/画面一覧
^^^^^^^^^^^^^^^^^

| 比較のメニュー一覧を以下に記述します。

.. figure:: /images/ja/menu_creation/comparison_function/compare_menu_list.png
   :width: 6.67391in
   :height: 3.20028in
   :align: left
   :alt: 比較メニュー一覧

   比較メニュー一覧

.. list-table:: 比較画面一覧
   :header-rows: 1
   :align: left

   * - | No
     - | メニューグループ
     - | メニュー・画面
     - | 説明
   * - | 1
     - | 比較
     - | 比較設定
     - | 比較実行する設定名の作成を行います。
       | 比較対象のパラメータシートの紐付を行います。
       | 詳細設定フラグを「True」にすると、比較詳細設定が設定可能になります。
   * - | 2
     - | 比較
     - | 比較詳細設定
     - | 比較するパラメータシートの項目について、
       | パラメータシートの項目単位での紐付設定を行います。
   * - | 3
     - | 比較
     - | 比較実行
     - | 比較設定・比較詳細設定で設定した、
       | 設定を元に比較を実施します。


比較機能の利用手順
==================

| 比較機能の利用手順について説明します。

作業フロー
^^^^^^^^^^

| 比較機能の実施における標準的なフローは以下の通りです。

比較機能実行フロー
************************

| 以下は、パラメータシートの比較を実行するまでの流れです。

- 作業フロー詳細と参照先

  #. | パラメータシートの作成
     | :menuselection:`パラメータシート作成\ --> パラメータシート定義/作成` 画面からパラメータシートを作成します。
     | 詳細は「:doc:`../create_param/menu_creation`」を参照してください。
  #. | パラメータシートへのデータ登録
     | 「パラメータシートの作成」にて作成したパラメータシートへデータを登録します。
     | 詳細は「:doc:`../create_param/menu_creation`」を参照してください。
  #. | 比較設定の作成
     | :menuselection:`比較\ --> 比較設定` 画面から、比較設定の設定を行います。
     | 詳細は「:ref:`about_compare_list`」を参照してください。
  #. | 比較詳細設定の設定
     | :menuselection:`比較\ --> 比較詳細設定` 画面から、比較詳細設定の設定を行います。
     | 詳細は「:ref:`about_compare_detail`」を参照してください。
  #. | 比較実行
     | :menuselection:`比較\ --> 比較実行` 画面から、パラメータシートの比較を行います。
     | 詳細は「:ref:`about_compare_execute`」を参照してください。


.. _about_how_to_use_compare:

比較機能・操作方法説明
======================

| 本章では、比較機能で利用する各メニューについて説明します。

比較
^^^^

.. _about_compare_list:

比較設定
********

#. | [比較設定]では、比較実行時に使用する設定情報（対象のパラメータシートの紐付）の登録、更新を行います。

   .. figure:: /images/ja/menu_creation/comparison_function/submenu_compare_list.png
      :width: 6.67391in
      :height: 3.20028in
      :align: left
      :alt: サブメニュー画面（比較設定）

      サブメニュー画面\(比較設定\)

#. | :menuselection:`一覧 --> 登録 or 編集` より、比較設定の登録を行います。

   .. figure:: /images/ja/menu_creation/comparison_function/edit_compare_list.png
      :width: 6.67391in
      :height: 3.20028in
      :align: left
      :alt: 登録、編集画面(比較設定)

      登録、編集画面\(比較設定\)


| 比較設定画面の項目一覧は以下の通りです。

.. list-table:: 比較設定の項目一覧
   :widths: 10 25 5 5 10
   :header-rows: 1
   :align: left

   * - | 項目
     - | 説明
     - | 入力必須
     - | 入力形式
     - | 制約事項
   * - | 比較名称
     - | 比較名称を入力します。
     - | ○
     - | 手動入力
     - |
   * - | 対象パラメータシート1
     - | 対象のパラメータシートを選択します。
     - | ○
     - | リスト選択
     - |
   * - | 対象パラメータシート2
     - | 対象のパラメータシートを選択します。
     - | ○
     - | リスト選択
     - |
   * - | 詳細設定フラグ
     - | 対象パラメータシート1、対象パラメータシート2の項目名、項目数が
       | 一致している場合に選択します。
       | \ False：比較詳細設定は不要です。
       | \ True：比較詳細設定が必要です。
     - | -
     - | 選択
     - | ※1
   * - | 備考
     - | 自由記述欄です。
     - | -
     - | 手動入力
     - |

.. note::
          | ※1 詳細設定フラグを「False」の場合、比較詳細設定の設定が不要になります。選択したパラメータシート同士の項目数、項目名が完全に一致している必要があります。


.. _about_compare_detail:

比較詳細設定
************

#. | \[比較詳細設定\]では、比較対象の項目名とパラメータシートの項目同士の紐付設定を行います。

   .. figure:: /images/ja/menu_creation/comparison_function/submenu_compare_detail.png
      :width: 6.67391in
      :height: 3.20028in
      :align: left
      :alt: サブメニュー画面\(比較詳細設定\)

      サブメニュー画面\(比較詳細設定\)


#. | :menuselection:`一覧 --> 登録 or 編集` より、比較項目の登録を行います。

   .. figure:: /images/ja/menu_creation/comparison_function/edit_compare_detail.png
      :width: 6.67391in
      :height: 3.20028in
      :align: left
      :alt: 登録、編集画面\(比較詳細設定\)

      登録、編集画面\(比較詳細設定\)


| 比較項目値管理画面の項目一覧は以下の通りです。

.. list-table:: 登録画面項目一覧(比較設定)
   :widths: 10 25 5 6 7
   :header-rows: 1
   :align: left

   * - | 項目
     - | 説明
     - | 入力必須
     - | 入力形式
     - | 制約事項
   * - | 比較名称
     - | 比較設定を選択
     - | ○
     - | リスト選択
     - | ※1
   * - | 比較項目名称
     - | 表示する項目名を入力します。
       | 比較結果で出力されるの項目名となります。
     - | ○
     - | 手動入力
     - |
   * - | 対象項目1
     - | 対象項目を選択します。
     - | ○
     - | リスト選択
     - | ※2
   * - | 対象項目2
     - | 対象項目を選択します。
     - | ○
     - | リスト選択
     - | ※3
   * - | 表示順
     - | 表示順を入力します。
       | 比較結果にて昇順で表示されます。
     - | ○
     - |
     - |
   * - | 備考
     - | 自由記述欄です。
     - | -
     - |
     - |

.. note::
          | ※1 比較設定にて詳細設定フラグが「True」設定しているものがリストに表示されます。
          | ※2 比較設定にて登録した対象パラメータシート1にある項目を選択して下さい。
          | ※3 比較設定にて登録した対象パラメータシート2にある項目を選択して下さい。

.. _about_compare_execute:

比較実行
********

| \[比較実行\] では、比較設定、比較詳細設定で設定した定義情報を元に、パラメータシートの比較を行います。
| ・\[比較設定\]で登録した比較設定の一覧が表示されます。
| ・ 比較ボタンを押下すると、入力されたパラメータを元に対象のパラメータシート、項目に対して比較が実行されます。
| ・ バンドル利用時のパラメータシートの比較は、 同一項目名、もしくは、比較詳細設定で紐づけた項目の同一代入順序同士で比較されます。


.. figure:: /images/ja/menu_creation/comparison_function/compare_execute.gif
   :width: 6.67391in
   :height: 3.20028in
   :align: left
   :alt: 比較実行画面

   比較実行画面


.. list-table:: 比較実行条件
   :header-rows: 1
   :align: left

   * - | パラメータ
     - | 説明
     - | 入力必須
     - | 入力形式
     - | 制約事項
   * - | 比較設定選択
     - | 比較設定を選択して下さい。
     - | ○
     - | リスト選択
     - |
   * - | 基準日時1
     - | 比較設定にて対象パラメータシート1 で選択したパラメータシートの
       | 基準となる日時を入力して下さい。 ※1
     - |
     - | 手動入力
     - | 入力しない場合、最新の基準日時が適応されます。
   * - | 基準日時2
     - | 比較設定にて対象パラメータシート2 で選択したパラメータシートの
       | 基準となる日時を入力して下さい ※1
     - |
     - | 手動入力
     - | 入力しない場合、最新の基準日時が適応されます。
   * - | ホスト選択
     - | 対象ホストを選択して下さい。
       | デフォルト：対象の絞り込みなし。 ※2
     - | -
     - | リスト選択
     - | -

.. note::
          | ※1 基準日時へ入力した場合、入力した日時の時点の最新のデータで比較実行します。入力しない場合、最新の基準日時のデータで比較実行します。
          | ※2 初期状態ではホストの絞り込みはされていません。比較設定内で紐付された対象パラメータシートにある全ホストの比較結果を出力します。


| 比較実行結果ついて

- | パラメータシートの比較

.. figure:: /images/ja/menu_creation/comparison_function/result_compare_execute.drawio.png
   :width: 6.67391in
   :height: 3.20028in
   :align: left
   :alt: 比較実行画面\(比較結果\)

   比較実行画面(比較結果)

- | パラメータシート(バンドル利用時)の比較

.. figure:: /images/ja/menu_creation/comparison_function/result_compare_execute_bundle.drawio.png
   :width: 6.67391in
   :height: 3.20028in
   :align: left
   :alt: 比較実行画面\(比較結果:バンドル利用\)

   比較実行画面(比較結果:バンドル利用)

- | パラメータシート(ファイルアップロード項目)の比較

.. figure:: /images/ja/menu_creation/comparison_function/result_compare_execute_file.png
   :width: 6.67391in
   :height: 3.20028in
   :align: left
   :alt: 比較実行画面\(比較結果:ファイルアップロード項目\)

   比較実行画面(比較結果:ファイルアップロード項目)

| 比較結果について
- | 対象ホスト
  | ホスト毎の比較結果の一覧を表示します。
  | 対象を選択すると、比較結果の詳細が表示されます。

.. list-table:: 対象ホストの出力一覧
   :header-rows: 1
   :align: left

   * - | 項目
     - | 説明
     - | 制約事項
   * - | 対象ホスト
     - | 対象ホスト名を表示します。
     - |
   * - | 差分
     - | 比較実行結果を表示します。差分がある場合、「✓」で表示します。
     - |

- | 比較結果
  | 比較結果下に、選択しているホスト名が表示され、比較結果の詳細が表示されます。

.. list-table:: 比較結果の表示内容一覧
   :header-rows: 1
   :align: left

   * - | 項目
     - | 説明
     - | 制約事項
   * - | 項目
     - | 項目名を表示します。
     -
   * - | 差分
     - | 項目の比較結果を表示します。
     - | 差分がある場合、「✓」で表示します。
   * - | 比較対象パラメーターシート1
     - | 比較対象パラメーターシート1の値を表示します。
     - | ヘッダーにパラメーターシート名が表示されます。
   * - | 比較対象パラメーターシート2
     - | 比較対象パラメーターシート2の値を表示します。
     - | ヘッダーにパラメーターシート名が表示されます。
   * - | 備考
     - | 各項目を比較した際に、その他の情報がある場合表示されます。
     - | ファイルアップロード:ファイル内容の比較結果表示用のボタンが表示されます。

.. tip:: | バンドル利用時の比較について
         - | 比較項目は、項目名[代入順序]の形式で表示されます。
         - | 同一項目名、もしくは、比較詳細設定で紐づけた項目の同一代入順序同士で比較されます。
         - | 項番、ホスト名、オペレーション名、基準日時は、表示されません。