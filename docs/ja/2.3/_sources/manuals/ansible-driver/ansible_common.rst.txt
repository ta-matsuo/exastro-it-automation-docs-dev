===========
Ansible共通 
===========

はじめに
========
| 本書では、Ansible driverの共通機能および操作方法について説明します。

Ansible driver概要
==================

| 本章では、Ansible Core、Ansible Automation ControllerおよびAnsible driverについて説明します。

Ansible Coreについて
--------------------

| Ansible Coreとは、多数の構築管理対象に対して、アプリーケーション/システムのデプロイ作業を容易にするPF構築自動化ツールです。
| Ansible Coreは、PlaybookというYAML形式のテキストファイルに定型処理をタスクとして記述し、それをAnsible Coreに実行させることにより、さまざまな処理を実現できます。
| タスクはモジュールと呼ばれる処理プログラムと紐付いており、さまざまな機器に対する制御を行うことができます。
| Ansible Coreの詳細情報については、Ansible公式マニュアルを参照してください。

Ansible Automation Controllerについて
-------------------------------------

| Ansible Automation Controllerとは、PF構築自動化ツールであるAnsibleにアクセスコントロール、ジョブスケジューリング、タスクの可視化などの機能を拡張した管理プラットフォームです。
| “プロジェクト”、”インベントリ”、”認証情報”の組合せで”ジョブテンプレート”を作成しAnsibleを実行できます。
| 複数の“ジョブテンプレート”を組み合せて”ワークフロージョブテンプレート”を作成することによって、より多彩な作業フローを表現することができます。
| Ansible Automation Controllerの詳細情報については、Ansible Automation Controller公式マニュアルを参照してください。
| ITAで対応可能なAnsible Automation Controllerのバージョンは、 :doc:`../../configuration/ansible/ansible_automation_platform` を参照してください。
| 最新のバージョンに対応した記法は使えないことがありますので、ご注意ください。


Ansible driverについて
----------------------

| Ansible driverは、ITAの機能で、ITAで登録した作業対象のサーバ・ストレージ・ネットワーク各機器に対し、Ansible Core、Ansible Automation Controllerのどちらを経由するかを選択し、Playbookの処理を自動的に行います。

.. image:: /images/ja/diagram/overview.png
   :width: 6.68819in
   :height: 3.35972in
   :alt: Exastro概要

| Ansible driverには用途に応じて以下の3つのモードを用意しています。

#. | **Legacy モード**
   | Ansible標準の機能を用いて各種ホストへ設定を投入します。
   | 構築コードを単体YAMLファイルとして登録し、作業パターンをその組み合わせで構成します。
   | サーバ・ストレージ・ネットワーク各機器の環境設定などの作業用に使われることを想定します。

#. | **Legacy Role モード**
   | Legacyモードと同じく、Ansible標準の機能を用いて各種ホストへ設定を投入します。
   | 構築コードをパッケージとして登録し、作業パターンをRoleの組み合わせで構成します。
   | 製品部門などが提供するRoleパッケージを用いて、製品のインストール、環境構築などを行う際に使われることを想定します。

#. | **Pioneer モード**
   | Ansibleに独自モジュールを追加し、対話形式による設定投入を可能とします。
   | Telnet, SSHでログイン可能なサーバ・ストレージ・ネットワーク各機器に対応しています。作業対象と直接やり取りが必要となるため、相応のITスキルが必要となります。


.. _ansible_common_variable_handling:

Ansible driverでの変数取り扱い
==============================

| Ansible driverでは、Playbook中の変数の具体値をITAから設定することができます。

変数の種類
----------

| Playbook中の変数で、ITAの変数として扱える変数は以下の7種類があります。


通常変数
^^^^^^^^

| 変数名に対して具体値を1つ定義できる変数です。
|
| e.g.) Playbook内での記述例

.. code-block:: yaml

   # Ansible-LegacyRoleでの変数定義例
   user: user1
   
   # Playbook内での記述例
   - name: Create user
     user: 
       name: "{{ user }}"

|

複数具体値変数
^^^^^^^^^^^^^^

| 変数名に対して具体値を複数定義できる変数です。
|
| e.g.) Playbook内での記述例

.. code-block:: yaml

   # Ansible-LegacyRoleでの変数定義例
   users:
     - user1
     - user2

   # Playbook内での記述例
   - name: Create user
     user:
       name: "{{ item }}"
     with_items: "{{ users }}"

|

多段変数
^^^^^^^^

| 階層化された変数です。
| 多段変数はAnsible-LegacyRoleでしか扱えません。
|
| e.g.) Playbook内での記述例

.. code-block:: yaml

   # Ansible-LegacyRoleでの変数定義例
   users:
     - name: user3
       groups: root
     - name: user4
       groups: root

   # Playbook内での記述例
   - name: Create user
     user:
       name: "{{ item.name }}"
     with_items: "{{ users }}"

|

グローバル変数
^^^^^^^^^^^^^^

| :menuselection:`Ansible共通 --> グローバル変数管理` から登録する変数です。

| e.g.) Playbook内での記述例

.. code-block:: yaml

   - command: echo {{ GBL_user }}

|

テンプレート埋込変数
^^^^^^^^^^^^^^^^^^^^

| :menuselection:`Ansible共通 --> テンプレート管理` から登録する変数です。

| e.g.) Playbook内での記述例

.. code-block:: yaml

   - template: src={{ TPF_SAMPLE }} dest=/tmp/SAMPLE.txt

|

ファイル埋込変数
^^^^^^^^^^^^^^^^

| :menuselection:`Ansible共通 --> ファイル管理` から登録する変数です。

| e.g.) Playbook内での記述例

.. code-block:: yaml

   - copy: src={{ CPF_SAMPLE }} dest=/tmp/SAMPLE.txt


.. _ansible_common_ita_original_variable:

ITA独自変数
^^^^^^^^^^^

| ITA 独自で定義している変数です。

機器一覧
********

|  :menuselection:`基本コンソール --> 機器一覧` の下記項目を変数として扱えます。

.. list-table::
   :widths: 50 80
   :header-rows: 1
   :align: left

   * - 項目名
     - 変数名
   * - ホスト名
     - __inventory_hostname__
   * - DNSホスト名
     - __dnshostname__
   * - IPアドレス
     - __ipaddress__
   * - プロトコル
     - __loginprotocol__
   * - ログインユーザID
     - __loginuser__
   * - ログインパスワード
     - __loginpassword__

.. tip:: 
  | 変数名の前後の「__」は半角アンダーバー2文字です。

| :menuselection:`Ansible共通 --> 機器一覧` の項目が設定されている場合に使用可能な変数です。\
  項目が未設定で :menuselection:`各モード --> 作業実行` から作業実行した場合はエラーになります。


オペレーション
**************

| 作業実行時に選択された :menuselection:`基本コンソール --> オペレーション一覧` のオペレーションを変数として扱えます。

.. list-table::
   :widths: 50 80
   :header-rows: 1
   :align: left

   * - 項目名
     - 変数名
   * - オペレーション
     - __operation__

| 設定値 : 「YYYY/MM/DD HH:MM」_「オペレーションID」:「オペレーション名称」
| YYYY/MM/DD HH:MM: :menuselection:`基本コンソール --> オペレーション一覧` の :menuselection:`実施予定日時` 
| オペレーションID: :menuselection:`基本コンソール --> オペレーション一覧` の :menuselection:`オペレーションID`
| オペレーション名称: :menuselection:`基本コンソール --> オペレーション一覧` の :menuselection:`オペレーション名称`
|

ConductorインスタンスID
***********************

| Conductor実行時の :menuselection:`Conductor --> Conductor作業確認` の :menuselection:`ConductorインスタンスID` を変数として扱えます。
| Conductorについての詳細は「 :doc:`../it_automation_base/conductor` 」を参照してください。

.. list-table::
   :widths: 50 80
   :header-rows: 1
   :align: left

   * - 項目名
     - 変数名
   * - ConductorインスタンスID
     - __conductor_id__

| __conductor_id__はConductor実行の場合に使用可能な変数です。
|  :menuselection:`各モード --> 作業実行` から作業実行した場合はエラーになります。
|

データ連携
**********

| 作業実行時の作業ディレクトリパスを下記の変数として扱えます。

.. list-table::
   :widths: 50 80
   :header-rows: 1
   :align: left

   * - 項目名
     - 変数名
   * - 作業ディレクトリパス
     - __workflowdir__

| Playbook内で作業ディレクトリパス配下にファイルを作成することで、 :menuselection:`各モード --> 作業管理` の :menuselection:`結果データ` からファイルをダウンロードすることができます。
|

| Conductor実行時の各Movementで共有するディレクトリパスを下記の変数として扱えます。

.. list-table::
   :widths: 50 80
   :header-rows: 1
   :align: left

   * - 項目名
     - 変数名
   * - Conductor作業ディレクトリパス
     - __conductor_workflowdir__

| Playbook内でConductor作業ディレクトリパス配下にファイルを作成することで、Conductor内の各Movement間でファイルを共有することが出来ます。
| また、 :menuselection:`各モード --> 作業実行` から作業実行した場合は、__workflowdir__と同じパスが設定されます。
|


| :menuselection:`Conductor --> Conductor編集/作業実行` の :menuselection:`Status file branchノード` で参照するステータスファイルのファイルパスを下記の変数として扱えます。
| :menuselection:`Status file branchノード` についての詳細は「 :doc:`../it_automation_base/conductor` 」を参照してください。

.. list-table::
   :widths: 50 80
   :header-rows: 1
   :align: left

   * - 項目名
     - 変数名
   * - ステータスファイルパス
     - __movement_status_filepath__

|

| 収集機能で使用する各ファイルパスを下記の変数として扱えます。
| 収集機能についての詳細は「 :doc:`./collect` 」を参照してください。

.. list-table::
   :widths: 50 80
   :header-rows: 1
   :align: left

   * - 項目名
     - 変数名
   * - 作業ディレクトリ（in）の「_parameters」のパス
     - __parameters_dir_for_epc__
   * - 作業ディレクトリ（in）の「_parameters_file」のパス
     - __parameters_file_dir_for_epc__
   * - 作業結果ディレクトリ（out）の「_parameters」のパス
     - __parameter_dir__
   * - 作業結果ディレクトリ（out）の「_parameters_file」のパス
     - __parameters_file_dir__

| 「_parameters」：ソースファイル（パラメータ）格納先用
| 「_parameters_file」：収集したファイルの格納先用
| ※パラメータの対象がファイルアップロードカラムの場合のファイル配置
|

変数の抜出および具体値登録
--------------------------


.. _ansible_common_var_listup:

変数抜出対象資材
^^^^^^^^^^^^^^^^
| 変数抜出対象の資材を登録した場合、登録された情報から変数を抜出します。

.. table:: 変数抜出対象のメニュー・項目
   :widths: 20 40 20 20 20 60
   :align: left

   +-----------------------+--------------------------------------+----------------+----------------+--------------------+---------------------------------------------------------------------------------+
   | メニュー              | 項目                                 |                       モード                         | 変数抜出の書式                                                                  |
   |                       |                                      +----------------+----------------+--------------------+                                                                                 |
   |                       |                                      | Ansible-Legacy | Ansible-Pioneer| Ansible-LegacyRole |                                                                                 |
   +=======================+======================================+================+================+====================+=================================================================================+
   | Playbook素材集        | Playbook素材                         | 〇             | ×              | ×                  | 詳細は「 :ref:`ansible_common_legacy_var_listup` 」を参照してください。         |
   +-----------------------+--------------------------------------+----------------+----------------+--------------------+---------------------------------------------------------------------------------+
   | 対話ファイル素材集    | 対話ファイル素材                     | ×              | 〇             | ×                  | 詳細は「 :ref:`ansible_common_pioneer_var_listup` 」を参照してください 。       |
   +-----------------------+--------------------------------------+----------------+----------------+--------------------+---------------------------------------------------------------------------------+
   | ロールパッケージ管理  | ロールパッケージファイル（ZIP形式）  | ×              | ×              | 〇                 | 詳細は「 :ref:`ansible_common_legacyrole_var_listup` 」を参照してください 。    |
   +-----------------------+--------------------------------------+----------------+----------------+--------------------+---------------------------------------------------------------------------------+
   | テンプレート管理      | 変数定義                             | 〇             | 〇             | 〇                 | 詳細は「 :ref:`ansible_common_template_list` 」を参照してください 。            |
   +-----------------------+--------------------------------------+----------------+----------------+--------------------+---------------------------------------------------------------------------------+
   | 機器一覧              | インベントリファイル追加オプション   | 〇             | ×              | 〇                 | 詳細は「 :ref:`ansible_common_option_var_listup` 」を参照してください 。        |
   +-----------------------+--------------------------------------+----------------+----------------+--------------------+---------------------------------------------------------------------------------+
   | Movement一覧          | ヘッダセクション                     | 〇             | ×              | 〇                 | 詳細は「 :ref:`ansible_common_option_var_listup` 」を参照してください 。        |
   +-----------------------+--------------------------------------+----------------+----------------+--------------------+---------------------------------------------------------------------------------+
  
.. tip:: |  〇：抜出対象  ×：抜出対象外

.. _ansible_common_legacy_var_listup:

Playbook素材で変数抜出の対象となる変数の種類と書式
**************************************************

| :menuselection:`Ansible-Legacy --> Playbook素材集` の :menuselection:`Playbook素材` で変数抜出の対象となる変数の種類と書式は、以下の図のとおりです。

.. table::  Playbook素材で変数抜出の対象となる変数の種類と書式
   :widths: 4 8 16
   :align: left

   +-------------------------------+--------------------------------------+------------------------------------------------------------------------------------------+
   | 変数                          | 書式                                 | 具体値の設定                                                                             |
   +===============================+======================================+==========================================================================================+
   | 通常変数                      | .. code-block:: yaml                 | 具体値の登録は :menuselection:`Ansible-Legacy --> 代入値自動登録設定` より行います。     |
   |                               |                                      | :menuselection:`Ansible-Legacy --> 代入値自動登録設定` の :menuselection:`代入順序` が\  |
   | 複数具体値変数                |    {{△vvv△}}                         | 入力されている場合、複数具体値変数として扱います。                                       |
   |                               |                                      |                                                                                          |
   |                               |    {{△vvv△|△フィルタ△}}              |                                                                                          |
   |                               |                                      |                                                                                          |
   +-------------------------------+--------------------------------------+------------------------------------------------------------------------------------------+
   | グローバル変数                | .. code-block:: yaml                 | 具体値の登録は :menuselection:`Ansible共通 --> グローバル変数管理` より行います。        |
   |                               |                                      |                                                                                          |
   |                               |    {{△GBL_xxx△}}                     |                                                                                          |
   |                               |                                      |                                                                                          |
   |                               |    {{△GBL_xxx△|△フィルタ△}}          |                                                                                          |
   +-------------------------------+--------------------------------------+------------------------------------------------------------------------------------------+
   | テンプレート埋込変数          | .. code-block:: yaml                 | 具体値の登録は :menuselection:`Ansible共通 --> テンプレート管理` より行います。          |
   |                               |                                      |                                                                                          |
   |                               |    {{△TPF_xxx△}}                     |                                                                                          |
   |                               |                                      |                                                                                          |
   |                               |    {{△TPF_xxx△|△フィルタ△}}          |                                                                                          |
   +-------------------------------+--------------------------------------+------------------------------------------------------------------------------------------+
   | ファイル埋込変数              | .. code-block:: yaml                 | 具体値の登録は :menuselection:`Ansible共通 --> ファイル管理` より行います。              |
   |                               |                                      |                                                                                          |
   |                               |    {{△CPF_xxx△}}                     |                                                                                          |
   |                               |                                      |                                                                                          |
   |                               |    {{△CPF_xxx△|△フィルタ△}}          |                                                                                          |
   |                               |                                      |                                                                                          |
   +-------------------------------+--------------------------------------+------------------------------------------------------------------------------------------+
   | ITA独自変数                   |                                      | 詳細は「 :ref:`ansible_common_ita_original_variable` 」を参照してください。              |
   +-------------------------------+--------------------------------------+------------------------------------------------------------------------------------------+

.. tip:: | 各変数名についての補足
    | △：半角スペース  
    | vvv: 255バイト以内の半角英数字とアンダースコア（ _ ）
    | xxx: 251バイト以内の半角英数字とアンダースコア（ _ ）


.. _ansible_common_pioneer_var_listup:
    
対話ファイル素材で変数抜出の対象となる変数の種類と書式
******************************************************

| :menuselection:`Ansible-Legacy --> 対話ファイル素材集` の :menuselection:`対話ファイル素材` で変数抜出の対象となる変数の種類と書式は、以下の図のとおりです。

.. table::  対話ファイル素材で変数抜出の対象となる変数の種類と書式
   :widths: 4 8 16
   :align: left

   +-------------------------------+--------------------------------------+------------------------------------------------------------------------------------------+
   | 変数                          | 書式                                 | 具体値の設定                                                                             |
   +===============================+======================================+==========================================================================================+
   | 通常変数                      | .. code-block:: yaml                 | 具体値の登録は :menuselection:`Ansible-Pioneer --> 代入値自動登録設定` より行います。    |
   |                               |                                      | :menuselection:`Ansible-Pioneer --> 代入値自動登録設定` の :menuselection:`代入順序` が\ |
   | 複数具体値変数                |    {{△vvv△}}                         | 入力されている場合、複数具体値変数として扱います。                                       |
   |                               |                                      |                                                                                          |
   +-------------------------------+--------------------------------------+------------------------------------------------------------------------------------------+
   | グローバル変数                | .. code-block:: yaml                 | 具体値の登録は :menuselection:`Ansible共通 --> グローバル変数管理` より行います。        |
   |                               |                                      |                                                                                          |
   |                               |    {{△GBL_xxx△}}                     |                                                                                          |
   |                               |                                      |                                                                                          |
   +-------------------------------+--------------------------------------+------------------------------------------------------------------------------------------+
   | テンプレート埋込変数          | .. code-block:: yaml                 | 具体値の登録は :menuselection:`Ansible共通 --> テンプレート管理` より行います。          |
   |                               |                                      |                                                                                          |
   |                               |    {{△TPF_xxx△}}                     |                                                                                          |
   |                               |                                      |                                                                                          |
   +-------------------------------+--------------------------------------+------------------------------------------------------------------------------------------+
   | ファイル埋込変数              | .. code-block:: yaml                 | 具体値の登録は :menuselection:`Ansible共通 --> ファイル管理` より行います。              |
   |                               |                                      |                                                                                          |
   |                               |    {{△CPF_xxx△}}                     |                                                                                          |
   |                               |                                      |                                                                                          |
   +-------------------------------+--------------------------------------+------------------------------------------------------------------------------------------+
   | ITA独自変数                   |                                      | 詳細は「 :ref:`ansible_common_ita_original_variable` 」を参照してください。              |
   +-------------------------------+--------------------------------------+------------------------------------------------------------------------------------------+

.. tip:: | 各変数名についての補足
    | △：半角スペース  
    | vvv: 255バイト以内の半角英数字とアンダースコア（ _ ）
    | xxx: 251バイト以内の半角英数字とアンダースコア（ _ ）

.. _ansible_common_legacyrole_var_listup:

ロールパッケージファイル（ZIP形式）で変数抜出の対象となる変数の種類と書式
*************************************************************************

| :menuselection:`Ansible-Legacy --> ロールパッケージ管理` の :menuselection:`ロールパッケージファイル（ZIP形式）` で変数抜出の対象となる変数の種類と書式は、以下の図のとおりです。

.. table::  ロールパッケージファイル（ZIP形式）で変数抜出の対象となる変数の種類と書式
   :widths: 4 8 2 4 4 4 24
   :align: left

   +-----------------+------------------------------------------+--------------+--------------+--------------+-------+------------------------------------------------------------+
   | 変数名          | 書式                                     | ITA readme   | ロールパッケージ内のディレクトリ    | 具体値の設定                                               |
   |                 |                                          |              |                                     |                                                            |
   |                 |                                          |              |                                     |                                                            |
   |                 |                                          |              |                                     |                                                            |
   |                 |                                          +              +--------------+--------------+-------+                                                            |
   |                 |                                          |              | defaults     | tasks        | そ\   |                                                            |
   |                 |                                          |              |              |              | の\   |                                                            |
   |                 |                                          |              |              | templates    | 他    |                                                            |
   |                 |                                          |              |              |              |       |                                                            |
   |                 |                                          |              |              | handlers     |       |                                                            |
   |                 |                                          |              |              |              |       |                                                            |
   |                 |                                          |              |              | meta         |       |                                                            |
   |                 |                                          |              |              |              |       |                                                            |
   +=================+==========================================+==============+==============+==============+=======+============================================================+
   | 通常変数        | e.g.)                                    | 〇           | 〇           | ×            | ×     | 具体値の登録は :menuselection:`Ansible-Legacy\             |
   |                 |                                          |              |              |              |       | Role --> 代入値自動登録設定` より行います。                |
   |                 | .. code-block:: yaml                     |              |              |              |       |                                                            |
   |                 |                                          |              |              |              |       |                                                            |
   |                 |    vvv: value                            |              |              |              |       |                                                            |
   |                 |                                          |              |              |              |       |                                                            |
   |                 | 具体値は省略可能です。                   |              |              |              |       |                                                            |
   |                 |                                          |              |              |              |       |                                                            |
   +-----------------+------------------------------------------+              +              +              |       +                                                            +
   | 複数具体値変数  | e.g.)                                    |              |              |              |       |                                                            |
   |                 |                                          |              |              |              |       |                                                            |
   |                 | .. code-block:: yaml                     |              |              |              |       |                                                            |
   |                 |                                          |              |              |              |       |                                                            |
   |                 |    vvv:                                  |              |              |              |       |                                                            |
   |                 |      - value                             |              |              |              |       |                                                            |
   |                 |    vvv: []                               |              |              |              |       |                                                            |
   |                 |                                          |              |              |              |       |                                                            |
   |                 | 具体値は省略可能です。                   |              |              |              |       |                                                            |
   |                 |                                          |              |              |              |       |                                                            |
   +-----------------+------------------------------------------+              +              +              |       +                                                            +
   | 多段変数        | e.g.)                                    |              |              |              |       |                                                            |
   |                 |                                          |              |              |              |       |                                                            |
   |                 | .. code-block:: yaml                     |              |              |              |       |                                                            |
   |                 |                                          |              |              |              |       |                                                            |
   |                 |    vvv:                                  |              |              |              |       |                                                            |
   |                 |      - item1: value1  ←メンバー変数      |              |              |              |       |                                                            |
   |                 |        item2: value2  ←メンバー変数      |              |              |              |       |                                                            |
   |                 |    vvv:                                  |              |              |              |       |                                                            |
   |                 |      - array:                            |              |              |              |       |                                                            |
   |                 |          - item1: value1 ←メンバー変数   |              |              |              |       |                                                            |
   |                 |            item2: value2 ←メンバー変数   |              |              |              |       |                                                            |
   |                 |                                          |              |              |              |       |                                                            |
   |                 | 具体値は省略可能です。                   |              |              |              |       |                                                            |
   |                 |                                          |              |              |              |       |                                                            |
   +-----------------+------------------------------------------+--------------+--------------+--------------+-------+------------------------------------------------------------+
   | グローバル変数  | .. code-block:: yaml                     | ×            | ×            | ○            | ×     | 具体値の登録は :menuselection:`Ansible共通 --> \           |
   |                 |                                          |              |              |              |       | グローバル変数管理` より行います。                         |
   |                 |    {{△GBL_xxx△}}                         |              |              |              |       |                                                            |
   |                 |                                          |              |              |              |       |                                                            |
   |                 |    {{△GBL_xxx△|△フィルタ△}}              |              |              |              |       |                                                            |
   +-----------------+------------------------------------------+              +              +              |       +------------------------------------------------------------+
   | テンプレート\   | .. code-block:: yaml                     |              |              |              |       | 具体値の登録は :menuselection:`Ansible共通 --> \           |
   | 埋込変数        |                                          |              |              |              |       | テンプレート管理` より行います。                           |
   |                 |    {{△TPF_xxx△}}                         |              |              |              |       |                                                            |
   |                 |                                          |              |              |              |       |                                                            |
   |                 |    {{△TPF_xxx△|△フィルタ△}}              |              |              |              |       |                                                            |
   +-----------------+------------------------------------------+              +              +              |       +------------------------------------------------------------+
   | ファイル埋込\   | .. code-block:: yaml                     |              |              |              |       | 具体値の登録は :menuselection:`Ansible共通 --> \           |
   | 変数            |                                          |              |              |              |       | ファイル管理` より行います。                               |
   |                 |    {{△CPF_xxx△}}                         |              |              |              |       |                                                            |
   |                 |                                          |              |              |              |       |                                                            |
   |                 |    {{△CPF_xxx△|△フィルタ△}}              |              |              |              |       |                                                            |
   +-----------------+------------------------------------------+              +              +              |       +------------------------------------------------------------+
   | ITA独自変数     |                                          |              |              |              |       | 詳細は「 :ref:`ansible_common_ita_original_variable` 」を\ |
   |                 |                                          |              |              |              |       | を参照してください。                                       |
   +-----------------+------------------------------------------+--------------+--------------+--------------+-------+------------------------------------------------------------+

.. tip:: |  〇：変数定義抜出対象   ×：変数定義抜出対象外

.. tip:: | 各変数名についての補足
    | △：半角スペース  
    | vvv: 255バイト以内の半角英数字とアンダースコア（ _ ）
    | xxx: 251バイト以内の半角英数字とアンダースコア（ _ ）
    | メンバー変数は、下記の7文字を除くascii文字(0x20～0x7e)が使用出来ます。
    | " . [ ] ' \\ :
    | 尚、コーテーションで囲ないと変数名の先頭に使用出来ない文字がいくつかあります。
    | 詳細は、Ansible公式マニュアルのYaml syntaxを参照してください。

.. _ansible_common_option_var_listup:

インベントリファイル追加オプションとヘッダセクションのパラメータ値で変数抜出の対象となる変数の種類と書式
********************************************************************************************************

| :menuselection:`Ansible-Legacy --> 機器一覧` の :menuselection:`インベントリファイル追加オプション` と :menuselection:`各モード --> Movement一覧` の :menuselection:`ヘッダセクション` のパラメータ値で変数抜出の対象となる変数の種類と書式は、以下の図のとおりです。

.. table:: パラメータ値で変数抜出の対象となる変数の種類と書式
   :widths: 25 15 30 80
   :align: left

   +------------------------+----------+-------------------------------+-------------------------------------------------------------------------------------------------------------------------------+
   | 種類                   | 利用可否 | 書式                          | 具体値の設定                                                                                                                  |
   +========================+==========+===============================+===============================================================================================================================+
   | 通常変数               | 〇       | .. code-block:: yaml          | ・Ansible-Legacyの場合                                                                                                        |
   |                        |          |                               |                                                                                                                               |
   | 複数具体値変数         |          |    {{△vvv△}}                  | 通常変数と複数具体値変数が扱えます。                                                                                          |
   |                        |          |                               |                                                                                                                               |
   | 多段変数               |          |    {{△vvv△|△フィルタ△}}       | :menuselection:`Ansible-Legacy --> 代入値自動登録設定` の :menuselection:`代入順序` が\                                       |
   |                        |          |                               | 入力されている場合、複数具体値変数として扱います。                                                                            |
   |                        |          |                               |                                                                                                                               |
   |                        |          |                               | ・Ansible-LegacyRoleの場合                                                                                                    |
   |                        |          |                               |                                                                                                                               |
   |                        |          |                               | 通常変数と複数具体値変数と多段変数が扱えます。                                                                                |
   |                        |          |                               |                                                                                                                               |
   |                        |          |                               | :menuselection:`Ansible-LegacyRole --> ロールパッケージ管理` の :menuselection:`ロールパッケージファイル（ZIP形式）` で\      |
   |                        |          |                               | 登録したロールパッケージか、 :menuselection:`Ansible共通 --> テンプレート管理` の :menuselection:`変数定義` で同名の\         |
   |                        |          |                               | 変数が定義されている場合は、定義されている種類の変数として扱います。                                                          |
   |                        |          |                               |                                                                                                                               |
   |                        |          |                               | 変数が定義されていない場合、通常変数として扱います。                                                                          |
   |                        |          |                               |                                                                                                                               |
   |                        |          |                               | 具体値の登録は :menuselection:`Ansible-LegacyRole --> 代入値自動登録設定` より行います。                                      |
   |                        |          |                               |                                                                                                                               |
   +------------------------+----------+-------------------------------+-------------------------------------------------------------------------------------------------------------------------------+
   | グローバル変数         | ×        |                               |                                                                                                                               |
   +------------------------+----------+-------------------------------+-------------------------------------------------------------------------------------------------------------------------------+
   | ファイル埋込変数       | ×        |                               |                                                                                                                               |
   +------------------------+----------+-------------------------------+-------------------------------------------------------------------------------------------------------------------------------+
   | テンプレート埋込変数   | ×        |                               |                                                                                                                               |
   +------------------------+----------+-------------------------------+-------------------------------------------------------------------------------------------------------------------------------+
   | ITA独自変数            | 〇       |                               | 詳細は「 :ref:`ansible_common_ita_original_variable` 」を参照してください。                                                   |
   +------------------------+----------+-------------------------------+-------------------------------------------------------------------------------------------------------------------------------+

.. tip:: | 各変数名についての補足
    | △：半角スペース  
    | vvv: 255バイト以内の半角英数字とアンダースコア（ _ ）


変数の具体値
^^^^^^^^^^^^

Ansible-Legacy
**************

| 抜出された変数の具体値はパラメータシートの項目に具体値を設定し :menuselection:`Ansible-Legacy --> 代入値自動登録設定` で各変数に紐付けを行うことで設定され、作業実行時にホスト変数ファイルに出力されます。
| 作業実行時に :menuselection:`Ansible-Legacy --> 代入値管理` を介してホスト変数ファイルに変数の具体値が出力されるまでの関係を、以下の図に示します。
| パラメータシートについての詳細は、「 :doc:`../create_param/menu_creation` 」を参照してください。

.. figure:: /images/ja/diagram/hensuu_nukidashi_legacy.png
   :alt: Ansible-Legacy ホスト変数ファイルに変数の具体値が出力されるまでの流れ
   :width: 800px

   Ansible-Legacy ホスト変数ファイルに変数の具体値が出力されるまでの流れ

| ① 「 :ref:`ansible_common_var_listup` 」により、変数抜出対象の資材より変数を抜出し、 :menuselection:`Ansible-Legacy --> 代入値自動登録設定` で変数が選択可能になります。
| ② パラメータシートの項目に紐付する変数の具体値を登録します。
| ③ :menuselection:`Ansible-Legacy --> 代入値自動登録設定` でパラメータシートの項目と変数の紐付を登録します。
| ④ 作業実行により :menuselection:`Ansible-Legacy --> 代入値自動登録設定` で紐付ているパラメータシートの項目と変数の情報を :menuselection:`Ansible-Legacy --> 代入値管理` に反映し、ホスト変数ファイルに出力します。


Ansible-Pioneer
***************

| 抜出された変数の具体値はパラメータシートの項目に具体値を設定し :menuselection:`Ansible-Pioneer --> 代入値自動登録設定` で各変数に紐付けを行うことで設定され、作業実行時にホスト変数ファイルへ出力されます。
| 作業実行時に :menuselection:`Ansible-Pioneer --> 代入値管理` を介してホスト変数ファイルに変数の具体値が出力されるまでの関係を、以下の図に示します。

.. figure:: /images/ja/diagram/hensuu_nukidashi_pioneer.png
   :alt: Ansible-Pioneer ホスト変数ファイルに変数の具体値が出力されるまでの流れ
   :width: 800px

   Ansible-Pioneer ホスト変数ファイルに変数の具体値が出力されるまでの流れ

| ① 「 :ref:`ansible_common_var_listup` 」により、変数抜出対象の資材より変数を抜出し、 :menuselection:`Ansible-Pioneer --> 代入値自動登録設定` で変数が選択可能になります。
| ② パラメータシートの項目に紐付する変数の具体値を登録します。
| ③ :menuselection:`Ansible-Pioneer --> 代入値自動登録設定` でパラメータシートの項目と変数の紐付を登録します。
| ④ 作業実行により :menuselection:`Ansible-Pioneer --> 代入値自動登録設定` で紐付ているパラメータシートの項目と変数の情報を :menuselection:`Ansible-Pioneer --> 代入値管理` に反映し、ホスト変数ファイルに出力します。

.. _ansible_common_legacy_role_var_value:
  
Ansible-LegacyRole
******************

| 抜出された変数の具体値はパラメータシートの項目に具体値を設定し :menuselection:`Ansible-LegacyRole --> 代入値自動登録設定` で各変数に紐付けを行うことで設定され、作業実行時にホスト変数ファイルへ出力されます。
| 作業実行時に :menuselection:`Ansible-LegacyRole --> 代入値管理` を介してホスト変数ファイルに変数の具体値が出力されるまでの関係を、以下の図に示します。

.. figure:: /images/ja/diagram/hensuu_nukidashi_legacyrole.png
   :alt: Ansible-LegacyRole ホスト変数ファイルに変数の具体値が出力されるまでの流れ
   :width: 800px

   Ansible-LegacyRole ホスト変数ファイルに変数の具体値が出力されるまでの流れ

| ① 「 :ref:`ansible_common_var_listup` 」により、変数抜出対象の資材より変数を抜出し、 :menuselection:`Ansible-LegacyRole --> 代入値自動登録設定` で変数が選択可能になります。
| ② パラメータシートの項目に紐付する変数の具体値を登録します。
| ③ :menuselection:`Ansible-LegacyRole --> 代入値自動登録設定` でパラメータシートの項目と変数の紐付を登録します。
| ④ 作業実行により :menuselection:`Ansible-LegacyRole --> 代入値自動登録設定` で紐付ているパラメータシートの項目と変数の情報を :menuselection:`Ansible-LegacyRole --> 代入値管理` に反映し、ホスト変数ファイルに出力します。

|  :menuselection:`Ansible-LegacyRole --> 代入値自動登録設定` で登録した変数の具体値は、ホスト変数定義ファイル（host_vars）に出力されます。
| この結果、ansibleが扱う変数の具体値の優先順位は以下のようになります。

#. | ホスト変数定義ファイルの値
#. | defaults変数定義ファイルに定義した値


Ansible共通メニュー構成
=======================

| 本章では、Ansible共通のメニュー構成について説明します。

メニュー/画面一覧
-----------------

.. include:: ../../include/ansible_option_ansible-common-console-menu.rst
 
.. tip:: | ※1 非表示メニューは、内部処理で使用するメニューです。
   | ITAをインストールした状態では表示されないメニューに設定されています。
   | 非表示メニューを表示するには、:menuselection:`管理コンソール --> ロール・メニュー紐付管理` で各メニューの復活処理を行います。詳細は「 :doc:`../it_automation_base/management_console` 」を参照してください。
   | 内部処理で使用するメニューには、登録を行わないようにしてください。

 
メニュー操作方法説明
====================

| 本章では、Ansible共通のメニューの操作について記載します。


.. _ansible_common_device_list:

機器一覧
--------

#. |  作業対象となる機器情報のメンテナンス（閲覧/登録/更新/廃止）を行います。

   .. figure:: /images/ja/ansible_common/devaicelist/device_list.png
      :width: 800px
      :alt: サブメニュー画面（機器一覧）

      サブメニュー画面（機器一覧）

#. |  :guilabel:`登録` ボタンより、作業対象となる機器情報の登録を行います。

   .. figure:: /images/ja/ansible_common/devaicelist/registration_device_list.gif
      :width: 800px
      :alt: 登録画面（機器一覧）

      登録画面（機器一覧）


#. | 登録画面の項目一覧は以下のとおりです。

   .. table:: 登録画面項目一覧（機器一覧）
      :widths: 8 8 8 8 18 12 12 12
      :align: left

      +-----------------------------------+--------------------------------------------------------+-----------+--------------+-----------------+
      | 項目                              | 説明                                                   | 入力必須  | 入力方法     | 制約事項        |
      |                                   |                                                        |           |              |                 |
      +===================================+========================================================+===========+==============+=================+
      | 管理システム項番                  | 登録時に自動採番した36桁の文字列が表示されます。       | ー        | 自動入力     | ー              |
      +-----------------------------------+--------------------------------------------------------+-----------+--------------+-----------------+
      | HW機器種別                        | HW機器の種別を選択します。                             | ー        | リスト選択   | 説明欄記載\     |
      |                                   |                                                        |           |              | のとおり        |
      |                                   | + | NW（ネットワーク）                                 |           |              |                 |
      |                                   | + | ST（ストレージ）                                   |           |              |                 |
      |                                   | + | SV（サーバー）                                     |           |              |                 |
      |                                   |                                                        |           |              |                 |
      +-----------------------------------+--------------------------------------------------------+-----------+--------------+-----------------+
      | ホスト名                          | ホスト名を入力します。                                 | ○         | 手動入力     | 最大長255バイト |
      |                                   |                                                        |           |              |                 |
      |                                   | Ansible実行時のインベントリホストとして扱います\       |           |              |                 |
      |                                   | 。                                                     |           |              |                 |
      +-----------------------------------+--------------------------------------------------------+-----------+--------------+-----------------+
      | DNSホスト名                       | DNSサーバーを使用してホスト名が解決できる\             | ー        | 手動入力     | 最大長255バイト |
      |                                   | 名称を入力します。                                     |           |              |                 |
      +-----------------------------------+--------------------------------------------------------+-----------+--------------+-----------------+
      | IPアドレス                        | IPアドレス（xxx.xxx.xxx.xxxIPv4形式）\                 | ー        | 手動入力     | 最大長15バイト  |
      |                                   | を入力します。                                         |           |              |                 |
      +-----------------+-----------------+--------------------------------------------------------+-----------+--------------+-----------------+
      | ログイン\       | ユーザ          | ログインユーザを入力します。                           | ー        | 手動入力     | 最大長255バイト |
      | パスワード      |                 |                                                        |           |              |                 |
      |                 +-----------------+--------------------------------------------------------+-----------+--------------+-----------------+
      |                 | パスワード      | パスワードを入力します。                               | ー        | 手動入力     | 最大長255バイト |
      +-----------------+-----------------+--------------------------------------------------------+-----------+--------------+-----------------+
      | ssh\            | ssh秘密鍵\      | ssh秘密鍵ファイルを指定して鍵認証する場合の\           | ー        | ファイル選択 | 最大サイズ\     |
      | 鍵認証\         | ファイル        | 秘密鍵ファイルを入力します。\                          |           |              | 100Mバイト      |
      | 情報            |                 |                                                        |           |              |                 |
      |                 |                 | アップロードしたファイルは暗号化されて保存\            |           |              |                 |
      |                 |                 | されます。                                             |           |              |                 |
      |                 |                 |                                                        |           |              |                 |
      |                 |                 | ※登録後はダウンロード不可となります。                  |           |              |                 |
      |                 +-----------------+--------------------------------------------------------+-----------+--------------+-----------------+
      |                 | パスフレーズ    | ssh秘密鍵ファイルにパスフレーズが設定され\             | ー        | 手動入力     | 最大長255バイト |
      |                 |                 | ている場合、パスフレーズを入力します。                 |           |              |                 |
      +--------+--------+-----------------+--------------------------------------------------------+-----------+--------------+-----------------+
      | Ansib\ | Legacy\| 認証方式        | Ansible core・Ansible Automation Controller\           | ー        | リスト選択   | 説明欄記載\     |
      | le利用\| /Role\ |                 | から作業対象へ接続する際の認証方式を選択します。       |           |              | のとおり        |
      | 情報   | 利用\  |                 |                                                        |           |              |                 |
      |        | 情報   |                 | + | パスワード認証                                     |           |              |                 |
      |        |        |                 |   | ログインパスワードの入力が必須です。               |           |              |                 |
      |        |        |                 |                                                        |           |              |                 |
      |        |        |                 | + | 鍵認証（パスフレーズなし）                         |           |              |                 |
      |        |        |                 |   | ssh秘密鍵ファイル（id_ras）のアップロード\         |           |              |                 |
      |        |        |                 |     が必須です。                                       |           |              |                 |
      |        |        |                 |                                                        |           |              |                 |
      |        |        |                 | + | 鍵認証（パスフレーズあり）                         |           |              |                 |
      |        |        |                 |   | ssh秘密鍵ファイル（id_ras）のアップロード          |           |              |                 |
      |        |        |                 |     と、パスフレーズの入力が必須です。                 |           |              |                 |
      |        |        |                 |                                                        |           |              |                 |
      |        |        |                 | + | パスワード認証（winrm）                            |           |              |                 |
      |        |        |                 |   | 必要に応じてWinRM接続情報を入力します。            |           |              |                 |
      |        |        |                 |                                                        |           |              |                 |
      |        |        +--------+--------+--------------------------------------------------------+-----------+--------------+-----------------+
      |        |        | WinRM\ | ポート\| WindowsServerにWinRM接続する際\                        | ー        | 手動入力     | 0～65,535       |
      |        |        | 接続\  | 番号   | のポート番号を入力します。                             |           |              |                 |
      |        |        | 情報   |        |                                                        |           |              |                 |
      |        |        |        |        | 未入力の場合はデフォルト（5985 :http）で\              |           |              |                 |
      |        |        |        |        | 接続します。                                           |           |              |                 |
      |        |        |        +--------+--------------------------------------------------------+-----------+--------------+-----------------+
      |        |        |        | サーバ\| WinRM接続ポートでhttpsのポート番号を指定した\          | ー        | ファイル選択 | 最大サイズ\     |
      |        |        |        | 証明書 | 場合にサーバ証明書を入力します。                       |           |              | 100Mバイト      |
      |        |        |        |        |                                                        |           |              |                 |
      |        |        |        |        | アップロードしたファイルは暗号化されて保存\            |           |              |                 |
      |        |        |        |        | されます。                                             |           |              |                 |
      |        |        |        |        |                                                        |           |              |                 |
      |        |        |        |        | ※登録後はダウンロード不可となります。                  |           |              |                 |
      |        |        |        |        |                                                        |           |              |                 |
      |        |        |        |        | サーバ証明書の認証を省く場合、\                        |           |              |                 |
      |        |        |        |        | インベントリファイル追加オプション\                    |           |              |                 |
      |        |        |        |        | に下記を追記してください。                             |           |              |                 |
      |        |        |        |        |                                                        |           |              |                 |
      |        |        |        |        | .. code-block:: yaml                                   |           |              |                 |
      |        |        |        |        |                                                        |           |              |                 |
      |        |        |        |        |    ansible_winrm_server_cert_validation: ignore        |           |              |                 |
      |        |        |        |        |                                                        |           |              |                 |
      |        +--------+--------+--------+--------------------------------------------------------+-----------+--------------+-----------------+
      |        | Pione\ | プロトコル      | Pioneerから作業対象に接続する際の\                     | ー        | リスト選択   | 説明欄記載\     |
      |        | er\    |                 | プロトコルを選択します。                               |           |              | のとおり        |
      |        | 利用\  |                 |                                                        |           |              |                 |
      |        | 情報\  |                 | + | ssh                                                |           |              |                 |
      |        |        |                 |   | :menuselection:`認証方式` は\                      |           |              |                 |
      |        |        |                 |     パスワード認証（winrm）以外を選択                  |           |              |                 |
      |        |        |                 |     してださい。                                       |           |              |                 |
      |        |        |                 |                                                        |           |              |                 |
      |        |        |                 | + | telnet                                             |           |              |                 |
      |        |        |                 |   | :menuselection:`認証方式` で\                      |           |              |                 |
      |        |        |                 |     選択した認証方式は使用せずにtelnetで\              |           |              |                 |
      |        |        |                 |     接続します。                                       |           |              |                 |
      |        |        |                 |   | :menuselection:`ユーザ` と :menuselection:`パ\     |           |              |                 |
      |        |        |                 |     スワード` の入力が必須です。                       |           |              |                 |
      |        |        |                 |                                                        |           |              |                 |
      |        |        +-----------------+--------------------------------------------------------+-----------+--------------+-----------------+
      |        |        | OS種別          | 作業対象のOSを選択します。                             | ー        | リスト選択   | 説明欄記載\     |
      |        |        |                 |                                                        |           |              | のとおり        |
      |        |        |                 | OS種は :menuselection:`Ansible-\                       |           |              |                 |
      |        |        |                 | Pioneer --> OS種別` から登録します。                   |           |              |                 |
      |        |        +-----------------+--------------------------------------------------------+-----------+--------------+-----------------+
      |        |        | LANG            | :menuselection:`ログインユーザ` のLANG\                | ー        | リスト選択   | 説明欄記載\     |
      |        |        |                 | を選択します。                                         | ー        |              | のとおり        |
      |        |        |                 |                                                        |           |              |                 |
      |        |        |                 | 未選択の場合はデフォルト「utf-8」になります。          |           |              |                 |
      |        +--------+-----------------+--------------------------------------------------------+-----------+--------------+-----------------+
      |        | 接続オプション           | 作業対象に接続する際に設定したいオプション\            | ー        | 手動入力     | 最大長4000バイト|
      |        |                          | を入力します。                                         |           |              |                 |
      |        |                          |                                                        |           |              |                 |
      |        |                          | + | ssh接続の場合                                      |           |              |                 |
      |        |                          |   | :file:`/etc/ansible.cfg/ssh_args` や\              |           |              |                 |
      |        |                          |     :file:`/etc/ansible/ansible.cfg` に設定\           |           |              |                 |
      |        |                          |     しているsshオプション以外のオプション\             |           |              |                 |
      |        |                          |     を入力します。                                     |           |              |                 |
      |        |                          |                                                        |           |              |                 |
      |        |                          | + | telnet接続の場合                                   |           |              |                 |
      |        |                          |   | telnet接続時のオプションを入力します。             |           |              |                 |
      |        |                          |                                                        |           |              |                 |
      |        +--------------------------+--------------------------------------------------------+-----------+--------------+-----------------+
      |        | インベントリファイル\    | ITAが作成するインベントリファイルに\                   | ー        | 手動入力     | 最大長4000バイト|
      |        | 追加オプション           | 追加するパラメータがある場合に、\                      |           |              |                 |
      |        |                          | パラメータをyaml形式で入力します。                     |           |              |                 |
      |        |                          |                                                        |           |              |                 |
      |        |                          | 尚、Ansible-Pioneerでは適用しません。                  |           |              |                 |
      |        |                          |                                                        |           |              |                 |
      |        |                          | ITAが作成するインベントリファイルについては\           |           |              |                 |
      |        |                          | 「 :ref:`ansible_common_inventory_file` 」\            |           |              |                 |
      |        |                          | を参照してください。                                   |           |              |                 |
      |        |                          |                                                        |           |              |                 |
      |        |                          | e.g.)                                                  |           |              |                 |
      |        |                          |                                                        |           |              |                 |
      |        |                          | .. code-block:: yaml                                   |           |              |                 |
      |        |                          |                                                        |           |              |                 |
      |        |                          |    ansible_connection: network_cli                     |           |              |                 |
      |        |                          |    ansible_network_os: ios                             |           |              |                 |
      |        |                          |    ansible_become: yes                                 |           |              |                 |
      |        |                          |    ansible_become_method: enable                       |           |              |                 |
      |        |                          |                                                        |           |              |                 |
      |        |                          | 各パラメータ値を変数で記述することも出来ます。         |           |              |                 |
      |        |                          |                                                        |           |              |                 |
      |        |                          | .. code-block:: yaml                                   |           |              |                 |
      |        |                          |                                                        |           |              |                 |
      |        |                          |    ansible_become_password: '{{△vvv△}}'                |           |              |                 |
      |        |                          |                                                        |           |              |                 |
      |        |                          |    △：半角スペース                                     |           |              |                 |
      |        |                          |    ':シングル・ダブルコーテーションで必ず囲んで下さい。|           |              |                 |
      |        |                          |                                                        |           |              |                 |
      |        |                          | パラメータ値を変数で記述する場合の詳細は、\            |           |              |                 |
      |        |                          | 「 :ref:`ansible_common_option_var_listup` 」\         |           |              |                 |
      |        |                          | を参照してください 。                                  |           |              |                 |
      |        |                          |                                                        |           |              |                 |
      |        |                          | 変数の具体値は :menuselection:`各\                     |           |              |                 |
      |        |                          | モード --> 代入値自動登録設定` から\                   |           |              |                 |
      |        |                          | 登録します。                                           |           |              |                 |
      |        +--------+-----------------+--------------------------------------------------------+-----------+--------------+-----------------+
      |        | Ansi\  | インスタンス\   | Ansible Automation Controllerが\                       | ー        | リスト選択   | 説明欄記載\     |
      |        | ble \  | グループ名※1    | クラスタ構成の場合、どのインスタンスグループ\          |           |              | のとおり        |
      |        | Autom\ |                 | で実行するかを選択します。                             |           |              |                 |
      |        | ation \|                 |                                                        |           |              |                 |
      |        | Contr\ |                 | 未選択の場合はAnsible Automation Controllerに\         |           |              |                 |
      |        | oller \|                 | 設定されているデフォルトのインスタンスグループ\        |           |              |                 |
      |        | 利用 \ |                 | になります。                                           |           |              |                 |
      |        | 情報\  |                 |                                                        |           |              |                 |
      |        |        |                 | Ansible Automation Controllerがクラスタ構成\           |           |              |                 |
      |        |        |                 | でない場合は、未選択で構いません。                     |           |              |                 |
      |        |        +-----------------+--------------------------------------------------------+-----------+--------------+-----------------+
      |        |        | 接続タイプ      | Ansible Automation Controllerの\                       | ○         | リスト選択   | 説明欄記載\     |
      |        |        |                 | 認証情報の接続タイプを選択します。                     |           |              | のとおり        |
      |        |        |                 |                                                        |           |              |                 |
      |        |        |                 | 通常は「machine」を選択します。                        |           |              |                 |
      |        |        |                 |                                                        |           |              |                 |
      |        |        |                 | 「ansible_connectionをlocal」に設定する必要が\         |           |              |                 |
      |        |        |                 | あるNetwork OSなど場合に「Network」\                   |           |              |                 |
      |        |        |                 | を選択します。\                                        |           |              |                 |
      |        |        |                 |                                                        |           |              |                 |
      |        |        |                 | + | 「Network」を選択した場合                          |           |              |                 |
      |        |        |                 |   |  :menuselection:`インベントリファイル追加\         |           |              |                 |
      |        |        |                 |      オプション` にPlatform Options\                   |           |              |                 |
      |        |        |                 |     （ansible_connection以外）を設定する必要が\        |           |              |                 |
      |        |        |                 |      あります。                                        |           |              |                 |
      |        |        |                 |                                                        |           |              |                 |
      |        |        |                 | e.g.)                                                  |           |              |                 |
      |        |        |                 |                                                        |           |              |                 |
      |        |        |                 | インベントリファイル追加オプションの設定例             |           |              |                 |
      |        |        |                 |                                                        |           |              |                 |
      |        |        |                 | Network OSが「ios」の場合の設定値                      |           |              |                 |
      |        |        |                 |                                                        |           |              |                 |
      |        |        |                 | .. code-block:: yaml                                   |           |              |                 |
      |        |        |                 |                                                        |           |              |                 |
      |        |        |                 |    ansible_network_os: ios                             |           |              |                 |
      |        |        |                 |    ansible_become: yes                                 |           |              |                 |
      |        |        |                 |    ansible_become_method: enable                       |           |              |                 |
      |        |        |                 |                                                        |           |              |                 |
      |        |        |                 | 接続タイプについての詳細は、\                          |           |              |                 |
      |        |        |                 | Ansible Automation Controller公式マニュアルの\         |           |              |                 |
      |        |        |                 | ユーザガイドを参照してください。                       |           |              |                 |
      |        |        |                 |                                                        |           |              |                 |
      |        |        |                 | Network OSとansible_connectionの関連や\                |           |              |                 |
      |        |        |                 | Platform Optionsについての詳細は\                      |           |              |                 | 
      |        |        |                 | Ansible公式ドキュメントのPlatform Options\             |           |              |                 |
      |        |        |                 | を参照してください。                                   |           |              |                 |
      +--------+--------+-----------------+--------------------------------------------------------+-----------+--------------+-----------------+
      | 備考                              | 自由記述欄です。                                       | ー        | 手動入力     | 最大長4000バイト|
      +-----------------------------------+--------------------------------------------------------+-----------+--------------+-----------------+

   .. tip:: | ※1「 :ref:`ansible_common_aac_sync` 」で取得したデータから選択します。


.. _ansible_common_interface_information:

インターフェース情報
--------------------

#. | Ansible Core、Ansible Automation Controllerのいずれかを実行エンジンに選択し、実行エンジンのサーバへの接続インターフェース情報のメンテナンス（閲覧/更新）を行います。

   .. figure:: /images/ja/ansible_common/Interface_information/interface_information.png
      :width: 800px
      :alt: サブメニュー画面（インタフェース情報）

      サブメニュー画面（インタフェース情報）

#. | :guilabel:`編集` ボタンより、インターフェース情報の更新を行います。

   .. figure:: /images/ja/ansible_common/Interface_information/registration_interface_information.gif
      :width: 800px
      :alt: 登録画面（インタフェース情報）

      登録画面（インタフェース情報）


#. | 登録画面の項目一覧は以下のとおりです。

   .. table:: 登録画面項目一覧（インタフェース情報）
      :widths: 8 8 8 40 8 8 10
      :align: left

      +-----------------+--------+--------+---------------------------------------------------------------+-----------+--------------+-------------------------------------------------------+
      | 項目                              | 説明                                                          | 入力必須  | 入力方法     | 制約事項                                              |
      |                                   |                                                               |           |              |                                                       |
      +=================+========+========+===============================================================+===========+==============+=======================================================+
      | 項番                              | 登録時に自動採番した36桁の文字列が表示されます。              | ー        | 自動入力     | ー                                                    |
      +-----------------+--------+--------+---------------------------------------------------------------+-----------+--------------+-------------------------------------------------------+
      | 実行エンジン                      | 実行するエンジンを\                                           | ○         | リスト選択   | 説明欄記載のとおり。                                  |
      |                                   | 下記の2種類から選択します。                                   |           |              |                                                       |
      |                                   |                                                               |           |              |                                                       |
      |                                   | + | Ansible Core                                              |           |              |                                                       |
      |                                   | + | Ansible Automation Controller                             |           |              |                                                       |
      |                                   |                                                               |           |              |                                                       |
      +-----------------+--------+--------+---------------------------------------------------------------+-----------+--------------+-------------------------------------------------------+
      | Ansible \       | 代表ホスト      | :menuselection:`Ansible\                                      | ー        | リスト選択   | :menuselection:`実行エンジン` が\                     |
      | Automation \    |                 | 共通 --> Ansible Automation Controllerホスト一覧` に\         |           |              | Ansible Automation Controllerの場合に入力必須         |
      | Controller \    |                 | 登録されているハイブリットノードか制御ノードより、\           |           |              |                                                       |
      | インターフェース|                 | ITAと通信するAnsible Automation Controllerを選択します。      |           |              |                                                       |
      |                 |                 |                                                               |           |              |                                                       |
      |                 |                 |                                                               |           |              |                                                       |
      |                 |                 |                                                               |           |              |                                                       |
      |                 +--------+--------+---------------------------------------------------------------+-----------+--------------+-------------------------------------------------------+
      |                 | プロトコル      | Ansible Automation Controller\                                | ー        | 手動入力     | :menuselection:`実行エンジン` が\                     |
      |                 |                 | との接続プロトコルを\                                         |           |              | Ansible Automation Controllerの場合に入力必須         |
      |                 |                 | 「http」/「https」\                                           |           |              |                                                       |
      |                 |                 | のどちらかで入力します。                                      |           |              |                                                       |
      |                 |                 |                                                               |           |              |                                                       |
      |                 |                 |                                                               |           |              |                                                       |
      |                 |                 |                                                               |           |              |                                                       |
      |                 +--------+--------+---------------------------------------------------------------+-----------+--------------+-------------------------------------------------------+
      |                 | ポート          | Ansible Automation Controllerとの接続プロトコルの\            | ー        | 手動入力     | :menuselection:`実行エンジン` が\                     |
      |                 |                 | ポートを入力します。                                          |           |              | Ansible Automation Controllerの場合に入力必須         |
      |                 |                 |                                                               |           |              |                                                       |
      |                 |                 | 通常はhttps（443）を入力します。                              |           |              |                                                       |
      |                 |                 |                                                               |           |              |                                                       |
      |                 |                 |                                                               |           |              |                                                       |
      |                 |                 |                                                               |           |              |                                                       |
      |                 +--------+--------+---------------------------------------------------------------+-----------+--------------+-------------------------------------------------------+
      |                 | 組織名          | Ansible Automation Controller\                                | ー        | リスト選択   | :menuselection:`実行エンジン` が\                     |
      |                 | ※1              | に登録されている組織名を選択します。                          |           |              | Ansible Automation Controllerの場合に入力必須         |
      |                 |                 |                                                               |           |              |                                                       |
      |                 |                 |                                                               |           |              |                                                       |
      |                 |                 |                                                               |           |              |                                                       |
      |                 |                 |                                                               |           |              |                                                       |
      |                 |                 |                                                               |           |              |                                                       |
      |                 +--------+--------+---------------------------------------------------------------+-----------+--------------+-------------------------------------------------------+
      |                 | 認証トークン    | Ansible Automation Controllerに接続するユーザの認証トークン\  |           |              | 最大長255バイト                                       |
      |                 |                 | を入力します。                                                |           |              |                                                       |
      |                 |                 |                                                               |           |              | :menuselection:`実行エンジン` が\                     |
      |                 |                 |                                                               |           |              | Ansible Automation Controllerの場合に入力必須         |
      |                 |                 |                                                               |           |              |                                                       |
      |                 |                 |                                                               |           |              |                                                       |
      |                 |                 |                                                               |           |              |                                                       |
      |                 |                 |                                                               |           |              |                                                       |
      |                 |                 |                                                               |           |              |                                                       |
      |                 +--------+--------+---------------------------------------------------------------+-----------+--------------+-------------------------------------------------------+
      |                 | 実行時データ削除| 作業実行時に\                                                 | ー        | リスト選択   | :menuselection:`実行エンジン` が\                     |
      |                 |                 | ITAとAnsible Automation Controller\                           |           |              | Ansible Automation Controllerの場合に入力必須         |
      |                 |                 | 内に一時的に生成したデータリソースを作業終了後\               |           |              |                                                       |
      |                 |                 | に削除するかを選択します。                                    |           |              |                                                       |
      |                 |                 |                                                               |           |              |                                                       |
      |                 |                 | 「True」を選択した場合に削除します。                          |           |              |                                                       |
      |                 |                 |                                                               |           |              |                                                       |
      |                 |                 | 削除されるデータリソースについての詳細は\                     |           |              |                                                       |
      |                 |                 | 「 :ref:`ansible_common_aac_resources_list` 」を\             |           |              |                                                       |
      |                 |                 | 参照してください。                                            |           |              |                                                       |
      |                 |                 |                                                               |           |              |                                                       |
      |                 +--------+--------+---------------------------------------------------------------+-----------+--------------+-------------------------------------------------------+
      |                 | REST APIタイム\ | 作業実行時に\                                                 | ー        | 手動入力     | 60～3,600                                             |
      |                 | アウト値（単位\ | ITAからAnsible Automation Controller\                         |           |              |                                                       |
      |                 | 秒）            | へRestAPI発行時のタイムアウト値を入力します。                 |           |              |                                                       |
      |                 |                 |                                                               |           |              |                                                       |
      |                 |                 | 通常は60秒程度が推奨値です。                                  |           |              |                                                       |
      |                 |                 |                                                               |           |              |                                                       |
      |                 |                 | 未入力の場合は、デフォルト値（60）を使用します。              |           |              |                                                       |
      |                 |                 |                                                               |           |              |                                                       |
      +-----------------+--------+--------+---------------------------------------------------------------+-----------+--------------+-------------------------------------------------------+
      | Proxy           | Address         | プロキシサーバのアドレスを入力します。                        | ー        | 手動入力     | 最\                                                   |
      |                 |                 |                                                               |           |              | 大255バイト                                           |
      |                 |                 | ITAがプロキシ環境下にある場合、\                              |           |              |                                                       |
      |                 |                 | Ansible Core/Ansible Automation Controller\                   |           |              |                                                       |
      |                 |                 | までの疎通のために設定が必要な場合があります。                |           |              |                                                       |
      |                 |                 |                                                               |           |              |                                                       |
      |                 |                 | プロキシサーバのURLが\                                        |           |              |                                                       |
      |                 |                 |                                                               |           |              |                                                       |
      |                 |                 | \http://\                                                     |           |              |                                                       |
      |                 |                 | proxy.gate.co.jp:8080の場合\                                  |           |              |                                                       |
      |                 |                 |                                                               |           |              |                                                       |
      |                 |                 | Addressには\                                                  |           |              |                                                       |
      |                 |                 | http://proxy.gate.co.jp\                                      |           |              |                                                       |
      |                 |                 | を入力します。                                                |           |              |                                                       |
      |                 |                 |                                                               |           |              |                                                       |
      |                 |                 | Portには 8080を入力します。                                   |           |              |                                                       |
      |                 |                 |                                                               |           |              |                                                       |
      |                 +--------+--------+---------------------------------------------------------------+-----------+--------------+-------------------------------------------------------+
      |                 | Port            | プロキシサーバのポートを入力します。                          | ー        | 手動入力     | 1～65,535                                             |
      |                 |                 |                                                               |           |              |                                                       |
      +-----------------+--------+--------+---------------------------------------------------------------+-----------+--------------+-------------------------------------------------------+
      | Ansible-vaultパスワード           | ansible-vaultコマンドで\                                      | ー        | 手動入力     | 最大\                                                 |
      |                                   | 変数の具体値を暗号化する場合の\                               |           |              | 長64バイト                                            |
      |                                   | パスワードを入力します。                                      |           |              |                                                       |
      |                                   |                                                               |           |              |                                                       |
      |                                   | 未入力の場合は、デフォルト値を使用します。                    |           |              |                                                       |
      +-----------------+--------+--------+---------------------------------------------------------------+-----------+--------------+-------------------------------------------------------+
      | オプションパラメータ              | Movement共通の\                                               | ー        | 手動入力     | 最大\                                                 |
      |                                   | オプションパラメータを入力します。                            |           |              | 長4000バイト                                          |
      |                                   |                                                               |           |              |                                                       |
      |                                   | オプションパラメータについての詳細は\                         |           |              |                                                       |
      |                                   | 「 :ref:`ansible_common_option_parameter_list` 」\            |           |              |                                                       |
      |                                   | を参照してください。                                          |           |              |                                                       |
      |                                   |                                                               |           |              |                                                       |
      |                                   | + | :menuselection:`実行エンジン` が「Ansible Core」の場合    |           |              |                                                       |
      |                                   |   | ansible-playbookコマンドの\                               |           |              |                                                       |
      |                                   |     オプションパラメータを入力します。                        |           |              |                                                       |
      |                                   |                                                               |           |              |                                                       |
      |                                   | + | :menuselection:`実行エンジン` が\                         |           |              |                                                       |
      |                                   |     「Ansible Automation Controller」の場合                   |           |              |                                                       |
      |                                   |   | ジョブテンプレートのパラメータを入力します。              |           |              |                                                       |
      |                                   |   | ジョブテンプレートについての詳細は、\                     |           |              |                                                       |
      |                                   |     Ansible Automation Controller公式マニュアルの\            |           |              |                                                       |
      |                                   |     ユーザガイドを参照してください。                          |           |              |                                                       |
      |                                   |                                                               |           |              |                                                       |
      |                                   | Movement固有のオプションパラメータ\                           |           |              |                                                       |
      |                                   | は :menuselection:`各モード --> Movement一覧` から入力します。|           |              |                                                       |
      |                                   |                                                               |           |              |                                                       |
      +-----------------+--------+--------+---------------------------------------------------------------+-----------+--------------+-------------------------------------------------------+
      | NULL連携                          | :menuselection:`各\                                           | ○         | リスト選択   | 説明欄記載のとおり。                                  |
      |                                   | モード --> 代入値自動登録設定` で :menuselection:`パラメータ\ |           |              |                                                       |
      |                                   | シート` の具体値がNULL（空白）の場合\                         |           |              |                                                       |
      |                                   | に、 :menuselection:`各モード --> 代入値管理` に\             |           |              |                                                       |
      |                                   | NULL（空白）の値を登録するかを選択します。                    |           |              |                                                       |
      |                                   |                                                               |           |              |                                                       |
      |                                   | :menuselection:`各モー\                                       |           |              |                                                       |
      |                                   | ド --> 代入値自動登録設定` の :menuselection:`NULL連携` が\   |           |              |                                                       |
      |                                   | 未選択の場合、この値が適用されます。                          |           |              |                                                       |
      |                                   |                                                               |           |              |                                                       |
      |                                   | + | True                                                      |           |              |                                                       |
      |                                   |   | パラメータシートの値がどのような\                         |           |              |                                                       |
      |                                   |     値でも :menuselection:`各モード --> 代入値管理` に\       |           |              |                                                       |
      |                                   |     登録が行われます。                                        |           |              |                                                       |
      |                                   |                                                               |           |              |                                                       |
      |                                   | + | False                                                     |           |              |                                                       |
      |                                   |   | パラメータシートに値が入力\                               |           |              |                                                       |
      |                                   |     されていれば :menuselection:`各モード --> 代入値管理` に\ |           |              |                                                       |
      |                                   |     登録が行われます。                                        |           |              |                                                       |
      |                                   |                                                               |           |              |                                                       |
      |                                   | 未選択の場合「False」を適用\                                  |           |              |                                                       |
      |                                   | します。                                                      |           |              |                                                       |
      |                                   |                                                               |           |              |                                                       |
      +-----------------+--------+--------+---------------------------------------------------------------+-----------+--------------+-------------------------------------------------------+
      | 状態監視周期（単位ミリ秒）        | :menuselection:`各モード --> 作業状態確認` に表示\            | ○         | 手動入力     | 1,000～2,147,483,647                                  |
      |                                   | される情報のリフレッシュ間隔を入力します。                    |           |              |                                                       |
      |                                   |                                                               |           |              |                                                       |
      |                                   | 通常は3000ミリ秒程度が推奨値です。                            |           |              |                                                       |
      |                                   |                                                               |           |              |                                                       |
      +-----------------+--------+--------+---------------------------------------------------------------+-----------+--------------+-------------------------------------------------------+
      | 進行状態表示行数                  | :menuselection:`各モード --> 作業状態確認` に\                | ○         | 手動入力     | 0～2,147,483,647                                      |
      |                                   | 表示する実行ログ・エラーログの最大表示行数を入力します。      |           |              |                                                       |
      |                                   |                                                               |           |              |                                                       |
      |                                   | :menuselection:`ステータス` が以下の場合、\                   |           |              |                                                       |
      |                                   | ログの終端から入力した行数分を出力します。                    |           |              |                                                       |
      |                                   |                                                               |           |              |                                                       |
      |                                   | + | 「未実行」                                                |           |              |                                                       |
      |                                   | + | 「準備中」                                                |           |              |                                                       |
      |                                   | + | 「実行中」                                                |           |              |                                                       |
      |                                   | + | 「実行中（遅延）」                                        |           |              |                                                       |
      |                                   |                                                               |           |              |                                                       |
      |                                   | :menuselection:`ステータス` が以下の場合、\                   |           |              |                                                       |
      |                                   | すべてのログを出力します。\                                   |           |              |                                                       |
      |                                   |                                                               |           |              |                                                       |
      |                                   | + | 「完了」                                                  |           |              |                                                       |
      |                                   | + | 「完了（異常）」                                          |           |              |                                                       |
      |                                   | + | 「想定外エラー」                                          |           |              |                                                       |
      |                                   | + | 「緊急停止」                                              |           |              |                                                       |
      |                                   | + | 「未実行（予約）」                                        |           |              |                                                       |
      |                                   | + | 「予約取消」                                              |           |              |                                                       |
      |                                   |                                                               |           |              |                                                       |
      |                                   | 環境毎にチューニングを要しますが、\                           |           |              |                                                       |
      |                                   | 通常は1000行程度が推奨値です。                                |           |              |                                                       |
      |                                   |                                                               |           |              |                                                       |
      +-----------------+--------+--------+---------------------------------------------------------------+-----------+--------------+-------------------------------------------------------+
      | 備考                              | 自由記述欄です。                                              | ー        | 手動入力     | 最大長\                                               |
      |                                   |                                                               |           |              | 4000バイト                                            |
      +-----------------+--------+--------+---------------------------------------------------------------+-----------+--------------+-------------------------------------------------------+


   .. tip:: | ※1「 :ref:`ansible_common_aac_sync` 」で取得したデータから選択します。


.. _ansible_common_ansible_automation_controller_hosts:

Ansible Automation Controller ホスト一覧
----------------------------------------

#. | Ansible Automation ControllerへのRestAPI実行に必要な情報、および構築資材をAnsible Automation Controllerにファイル転送するために必要な情報のメンテナンス(閲覧/登録/更新/廃止)を行います。
   | クラスタ構成の場合は、構成している全てのホストを登録してください。
   | ただし、Ansible Automation Controllerのhop nodeの登録は不要です。

   .. figure:: /images/ja/ansible_common/ansible_automation_controller/ansible_automation_controller_host_list.png
      :width: 800px
      :alt: サブメニュー画面（Ansible Automation Controller ホスト一覧）

      サブメニュー画面（Ansible Automation Controller ホスト一覧）

#. | :guilabel:`登録` ボタンより、Ansible Automation Controllerのホスト情報の登録を行います。

   .. figure:: /images/ja/ansible_common/ansible_automation_controller/ansible_automation_controller_host_list.gif
      :width: 800px
      :alt: 登録画面（Ansible Automation Controller ホスト一覧）

      登録画面（Ansible Automation Controller ホスト一覧）

#. | 登録画面の項目一覧は以下のとおりです。

   .. table:: 登録画面項目一覧（Ansible Automation Controller ホスト一覧）
      :align: left

      +-------------+--------------------------------------------------------+-------+-------+-------------------------------+
      | 項目　      | 説明                                                   | 入力\ | 入力\ | 制約事項                      |
      |             |                                                        | 必須  | 方法　|                               |
      |             |                                                        |       |       |                               |
      +=============+========================================================+=======+=======+===============================+
      | 項番        | 登録時に自動採番した36桁の文字列が表示されます。       | ー    | 自動\ | ー                            |
      |             |                                                        |       | 入力  |                               |
      +-------------+--------------------------------------------------------+-------+-------+-------------------------------+
      | ホスト      | Ansible Automation \                                   | ○     | 手動\ | 最大\                         |
      |             | Controller\                                            |       | 入力  | 長255バイト                   |
      |             | のホスト名（または\                                    |       |       |                               |
      |             | IPアドレス）を入力します。                             |       |       |                               |
      |             |                                                        |       |       |                               |
      +-------------+--------------------------------------------------------+-------+-------+-------------------------------+
      | 認証方式    | Ansible Automation \                                   | ○     | リス\ | 説明欄記載のとおり。          |
      |             | Controllerへ\                                          |       | ト選\ |                               |
      |             | ファイル転送(scp)で接続する\                           |       | 択    |                               |
      |             | 際の認証方式を選択します。                             |       |       |                               |
      |             |                                                        |       |       |                               |
      |             | + | パスワード認証                                     |       |       |                               |
      |             |   | ログインユーザとパ\                                |       |       |                               |
      |             |     スワードの入力が必須です。                         |       |       |                               |
      |             |                                                        |       |       |                               |
      |             | + | 鍵認証（パスフレーズなし）                         |       |       |                               |
      |             |   | ssh秘密鍵ファイル(id_ras\                          |       |       |                               |
      |             |     )のアップロードが必須です。                        |       |       |                               |
      |             |                                                        |       |       |                               |
      |             | + | 鍵認証（パスフレーズあり）                         |       |       |                               |
      |             |   | ssh秘密鍵ファイル(id\                              |       |       |                               |
      |             |     _ras)のアップロードと、パス\                       |       |       |                               |
      |             |     フレーズの入力が必須です。                         |       |       |                               |
      |             |                                                        |       |       |                               |
      +-------------+--------------------------------------------------------+-------+-------+-------------------------------+
      | ユーザ      | Ansible Automation \                                   | ○     | 手動\ | 最大\                         |
      |             | Controllerへファイ\                                    |       | 入力  | 長255バイト                   |
      |             | ル転送(scp)で接続する際の\                             |       |       |                               |
      |             | ログインユーザを入力します。                           |       |       |                               |
      |             |                                                        |       |       |                               |
      |             | ログインユーザは、\                                    |       |       |                               |
      |             | Ansible Automation Controllerインストール時に\         |       |       |                               |
      |             | 生成されるawxユーザにパスワードを設定し、\             |       |       |                               |
      |             | awxユーザを入力して下さい。                            |       |       |                               |
      +-------------+--------------------------------------------------------+-------+-------+-------------------------------+
      | パスワード  | :menuselection:`認証方式` でパスワード認証\            | ー    | 手動\ | 最大長\                       |
      |             | を選択した\                                            |       | 入力  | 4000バイト                    |
      |             | 場合、必須入力となります。                             |       |       |                               |
      |             | ログインユーザ\                                        |       |       |                               |
      |             | のパスワードを入力します。                             |       |       |                               |
      +-----+-------+--------------------------------------------------------+-------+-------+-------------------------------+
      | ssh\| ssh\  | :menuselection:`認証方式` で鍵認証を選択した\          | ー    | ファ\ | 最大サイ\                     |
      | 鍵\ | 秘密\ | 場合、必須入力となります。\                            |       | イル\ | ズ100Mバイト                  |
      | 認\ | 鍵\   | ssh秘密鍵ファイルを入力し\                             |       | 選択  |                               |
      | 証\ | ファ\ | ます。                                                 |       |       |                               |
      | 情\ | イル  |                                                        |       |       |                               |
      | 報  |       | アップロードしたファイルは\                            |       |       |                               |
      |     |       | 暗号化されて保存されます。                             |       |       |                               |
      |     |       |                                                        |       |       |                               |
      |     |       | ※登録後は\                                             |       |       |                               |
      |     |       | ダウンロード不可となります。                           |       |       |                               |
      |     +-------+--------------------------------------------------------+-------+-------+-------------------------------+
      |     | パス\ | ssh秘密鍵ファイルにパスフレ\                           | ー    | 手動\ | 最大\                         |
      |     | フレ\ | ーズが設定されている場合、\                            |       | 入力  | 長255バイト                   |
      |     | ーズ  | パスフレーズを入力します。                             |       |       |                               |
      +-----+-------+--------------------------------------------------------+-------+-------+-------------------------------+
      | ポート      | Ansible Automation Controllerにssh接続する\            | ー    | 手動\ | 数値項目\                     |
      |             | 際の、ポート番号を指定することができます。             |       | 入力  |                               |
      |             |                                                        |       |       |                               |
      |             | デフォルトは22です。                                   |       |       |                               |
      +-------------+--------------------------------------------------------+-------+-------+-------------------------------+
      | Exe\        | ク\                                                    | ー    | リス\ | 説明欄記載のとおり。          |
      | cut\        | ラスタ構成で構築されている\                            |       | ト選\ |                               |
      | ion \       | Ansible Automation \                                   |       | 択    |                               |
      | node\       | Controllerで対象ホストが\                              |       |       |                               |
      |             | 「execution node」\                                    |       |       |                               |
      |             | の場合に「True」\                                      |       |       |                               |
      |             | を選択します。                                         |       |       |                               |
      |             |                                                        |       |       |                               |
      |             | 「Execution node」が「True」の場合、\                  |       |       |                               |
      |             | :menuselection:`Ansible共通 --> インターフェース情報`\ |       |       |                               |
      |             | の :menuselection:`代表ホスト` に表示されません。      |       |       |                               |
      +-------------+--------------------------------------------------------+-------+-------+-------------------------------+
      | 備\         | 自由記述欄です。                                       | ー    | 手動\ | 最大長\                       |
      | 考          |                                                        |       | 入力  | 4000バイト                    |
      +-------------+--------------------------------------------------------+-------+-------+-------------------------------+


.. _ansible_common_global_variable_list:

グローバル変数管理
------------------

#. | Playbookや対話ファイルで共通利用するグローバル変数名のメンテナンス(閲覧/登録/更新/廃止)を行います。

   .. figure:: /images/ja/ansible_common/global_variable/global_variable_list.png
      :width: 800px
      :alt: サブメニュー画面（グローバル変数管理）

      サブメニュー画面（グローバル変数管理）

#. | :guilabel:`登録` ボタンより、グローバル変数の登録を行います。

   .. figure:: /images/ja/ansible_common/global_variable/global_variable_list.gif
      :width: 800px
      :alt: 登録画面（グローバル変数管理）

      登録画面（グローバル変数管理）

#. | 登録画面の項目一覧は以下のとおりです。

   .. list-table:: 登録画面項目一覧（グローバル変数管理）
      :widths: 20 80 10 10 10
      :header-rows: 1
      :align: left

      * - 項目
        - 説明
        - 入力必須 
        - 入力方法
        - 制約事項
      * - 項番
        - | 登録時に自動採番した36桁の文字列が表示されます。
        - ー 
        - 自動入力
        - ー 
      * - グローバル変数名
        - | 変数名を入力します。
          | 変数名は、「GBL_****」形式で入力します。
          | \****：半角英数字とアンダースコア（ _ ）が利用可能です。(最小値:1バイト、最大値:255バイト)
        - ○ 
        - 手動入力
        - 説明欄記載のとおり。
      * - 具体値
        - 具体値を入力します。複数行の具体値も入力できますが、Pioneerの対話ファイルで使用しているグローバル変数で複数行の具体値を設定すると、作業実行時にエラーとなります。
        - ー 
        - 手動入力
        - 最大長4000バイト
      * - 変数名説明
        - 変数に対する説明・コメントを入力します。
        - ー 
        - 手動入力
        - 最大長4000バイト
      * - 備考
        - 自由記述欄です。
        - ー 
        - 手動入力
        - 最大長4000バイト


.. _ansible_common_file_list:

ファイル管理
------------


#. | Playbookや対話ファイルで共通利用するファイル素材とファイル埋込変数のメンテナンス（閲覧/登録/更新/廃止）を行います。
   | ファイル素材を登録しておくことで、Playbook内で使用するファイル素材をファイル埋込変数名で指定することができます。

   .. figure:: /images/ja/ansible_common/file_management/contents_list.png
      :width: 800px
      :alt: サブメニュー画面（ファイル管理）

      サブメニュー画面（ファイル管理）

#. | :guilabel:`登録` ボタンより、ファイル埋込変数の登録を行います。

   .. figure:: /images/ja/ansible_common/file_management/contents_list.gif
      :width: 800px
      :alt: 登録画面（ファイル管理）

      登録画面（ファイル管理）


#. | 登録画面の項目一覧は以下のとおりです。

   .. list-table:: 登録画面項目一覧（ファイル管理）
      :widths: 15 50 5 10 20
      :header-rows: 1
      :align: left

      * - 項目
        - 説明
        - 入力必須
        - 入力方法
        - 制約事項
      * - 素材ID
        - | 登録時に自動採番した36桁の文字列が表示されます。
        - ー 
        - 自動入力
        - ー 
      * - ファイル埋込変数名
        - | Playbookに埋め込む変数名を入力します。
          | 変数名は、「CPF_****」形式で入力します。
          | \****\：半角英数字とアンダースコア（ _ ）が利用可能です。（最小値:1バイト、最大値:255バイト）
        - ○
        - 手動入力
        - 説明欄記載のとおり。
      * - ファイル素材
        - ファイル素材をアップロードします。
        - ○
        - ファイル登録
        - 最大サイズ100Mバイト
      * - 備考
        - 自由記述欄です。
        - ー
        - 手動入力
        - 最大長4000バイト


.. tip:: | **Ansible-Legacy・Ansible-LegacyRoleでのファイル埋込変数の使用例**
   | :menuselection:`Ansible共通 --> ファイル管理` で登録したファイル素材をPlaybookに記述する場合、ファイル埋込変数名を記述します。
   | ※ファイル名にスペースなどが含まれている場合、適切にクォーテーションで囲まないと、作業実行時にエラーになる場合があります。


   | e.g.)
   
   - | :menuselection:`Ansible共通 --> ファイル管理` で登録したhostsファイルをファイル埋込変数を使用して作業対象サーバの/etc/配下にコピーする場合

     #. | :menuselection:`Ansible共通 --> ファイル管理` からhostsファイルを登録します。

        .. list-table:: ファイル管理の登録内容
           :widths: 30 40
           :header-rows: 1
           :align: left

           * - ファイル埋込変数名
             - ファイル素材
           * - CPF_hosts
             - hosts


     #. | 下記のようにPlaybookを記述します。
        | ※destはファイル名も記述してください。ファイル名の指定がない場合、登録したファイル素材のファイル名の前にITAの管理番号が付与された名前のファイル名で処理されます。
        | 　たとえば、dest=/etc/ とした場合、ファイル名は/etc/36桁の文字列_hostsとなります。

        | **Playbookの記述**

        .. code-block:: yaml

           - copy: src='{{ CPF_hosts }}' dest=/etc/hosts

   - | :menuselection:`Ansible共通 --> ファイル管理` で登録したtool.tgzファイルをファイル埋込変数を使用して作業対象サーバの/usr/local/bin/配下に解凍する場合

     #. | :menuselection:`Ansible共通 --> ファイル管理` からtool.tgzファイルを登録します。

        .. list-table:: ファイル管理の登録内容
           :widths: 30 40
           :header-rows: 1
           :align: left

           * - ファイル埋込変数名
             - ファイル素材
           * - CPF_tool_tgz
             - tool.tgz


     #. | 下記のようにPlaybookを記述します。

        | **Playbookの記述**

        .. code-block:: yaml

           - unarchive: src={{ CPF_tool_tgz }} dest=/usr/local/bin

.. tip:: | **Ansible-Pioneerでのファイル埋込変数の使用例**
   | :menuselection:`Ansible共通 --> ファイル管理` で登録したファイル素材を対話ファイルに記述する場合、対話ファイルにファイル埋込変数名を記述します。
   | ※ファイル名にスペースなどが含まれている場合、適切にクォーテーションで囲まないと、作業実行時にエラーになる場合があります。


   | e.g.)

   - | :menuselection:`Ansible共通 --> ファイル管理` で登録したhostsファイルをファイル埋込変数を使用して作業対象サーバの/etc/配下にコピーする場合

     #. | :menuselection:`Ansible共通 --> ファイル管理` からhostsファイルを登録します。

        .. list-table:: ファイル管理の登録内容
           :widths: 30 40
           :header-rows: 1
           :align: left

           * - ファイル埋込変数名
             - ファイル素材
           * - CPF_hosts
             - hosts


     #. | 下記のように対話ファイルを記述します。
        | ※転送先はファイル名も記述してください。ファイル名の指定がない場合、登録したファイル素材のファイル名の前にITAの管理番号が付与された名前のファイル名で処理されます。
        | 　たとえば、/etc/. とした場合、ファイル名は/etc/36桁の文字列_hostsとなります。

        | **対話ファイルの記述**

        .. code-block:: yaml

          conf:
            # ファイルのサイズでタイマ値調整
            timeout: 60
          exec_list:
            # 対象機器へのログインパスワード認証
            - expect: 'password:'
              exec: '{{ __loginpassword__ }}'
            # 作業対象側よりscpコマンドでAAC側に配置されているファイルを作業対象にファイル転送
            - expect: '{{ __loginuser__ }}@{{ __dnshostname__ }}'
              exec: 'scp -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null {{ VAR_scp_user }}@{{ VAR_aac_host }}:{{ CPF_hosts }} /etc/hosts'
            # scpコマンドのパスワードログイン認証(AAC側)
            - expect: 'password:'
              exec: '{{ VAR_scp_user_password }}'
            # 対話ファイル終了
            - expect: '{{ __loginuser__ }}@{{ __dnshostname__ }}'
              exec: exit

        .. list-table:: 変数の具体値
           :widths: 30 40
           :header-rows: 1
           :align: left

           * - 変数
             - 具体値
           * - VAR_scp_user
             - awx
           * - VAR_scp_user_password
             - awxユーザパスワード
           * - VAR_aac_host
             - Ansible Automation Controller

.. _ansible_common_template_list:

テンプレート管理
----------------

#. | Playbookや対話ファイルで共通利用するテンプレートファイル素材とテンプレート埋込変数のメンテナンス（閲覧/登録/更新/廃止）を行います。
   | テンプレートファイル素材を登録しておくことで、Playbook内で使用するテンプレートファイル素材をテンプレート埋込変数で指定することができます。

   .. figure:: /images/ja/ansible_common/template_management/template_list.png
      :width: 800px
      :alt: サブメニュー画面（テンプレート管理）

      サブメニュー画面（テンプレート管理）

#. | :guilabel:`登録` ボタンより、テンプレート埋込変数の登録を行います。

   .. figure:: /images/ja/ansible_common/template_management/template_list.gif
      :width: 800px
      :alt: 登録画面（テンプレート管理）

      登録画面（テンプレート管理）


#. | 登録画面の項目一覧は以下のとおりです。

   .. list-table:: 登録画面項目一覧（テンプレート管理）
      :widths: 15 50 5 10 20
      :header-rows: 1
      :align: left

      * - 項目
        - 説明
        - 入力必須
        - 入力方法
        - 制約事項
      * - 素材ID
        - | 登録時に自動採番した36桁の文字列が表示されます。
        - ー 
        - 自動入力
        - ー 
      * - テンプレート埋込変数名
        - | Playbookに埋め込む変数名を入力します。
          | 変数名は、「TPF_****」形式で入力します。
          | \****\：半角英数字とアンダースコア（ _ ）が利用可能です。（最小値:1バイト、最大値:255バイト）
        - ○
        - 手動入力
        - 説明欄記載のとおり。
      * - テンプレート素材
        - Playbookで使用するテンプレートファイル素材をアップロードします。
        - ○
        - ファイル登録
        - | テキスト形式
          | 最大サイズ100Mバイト
      * - 変数定義
        - | テンプレートファイル素材内で使用している変数を定義します。
          | テンプレートファイル素材内で使用出来る変数は5種類あります。※1
        - ー
        - 手動入力
        - 最大長4000バイト
      * - 備考
        - 自由記述欄です。
        - ー
        - 手動入力
        - 最大長4000バイト


.. warning:: | **テンプレートの変数定義から変数を抽出するタイミング**
   | 内部の処理でテンプレートの変数定義から変数を抽出します。抽出した変数は、 :menuselection:`各モード --> 代入値自動登録設定` で具体値が登録可能になります。
   | 抽出のタイミングはリアルタイムではないので、 :menuselection:`各モード --> 代入値自動登録設定` で変数が扱えるまでに **時間がかかる** 場合があります。

.. tip:: | ※1 **変数定義の注意事項**
   | テンプレートファイル内で使用する変数は、 :menuselection:`変数定義` に入力する必要があります。
   | テンプレートファイル内で使用出来る変数は5種類あります。変数定義の注意事項は以下のとおりです。
   | 同名の変数をdefault変数定義ファイルなどに定義している場合は、変数構造を合わせる必要があります。変数構造が一致していない場合は登録でエラーとなります。

   .. table:: 変数定義の注意事項
      :widths: 10 30
      :align: left

      +---------------+------------------------------------------------------+
      | 種類          | 注意事項                                             |
      +===============+======================================================+
      | 通常変数      | 具体値は省略可能です。                               |
      |               |                                                      |
      |               | e.g.)                                                |
      |               |                                                      |
      |               | .. code-block:: yaml                                 |
      |               |                                                      |
      |               |    vvv: value                                        |
      |               |                                                      |
      +---------------+------------------------------------------------------+
      | 複\           | 具体値は省略可能です。                               |
      | 数具体値変数  |                                                      |
      |               | e.g.)                                                |
      |               |                                                      |
      |               | .. code-block:: yaml                                 |
      |               |                                                      |
      |               |    vvv:                                              |
      |               |      - vaule                                         |
      |               |    vvv: []                                           |
      |               |                                                      |
      +---------------+------------------------------------------------------+
      | 多段変数      | 階層化された変数構造が定義出来ます。                 |
      |               |                                                      |
      |               | e.g.)                                                |
      |               |                                                      |
      |               | .. code-block:: yaml                                 |
      |               |                                                      |
      |               |    vvv:                                              |
      |               |      - item1: value       ←メンバー変数              |
      |               |        item2:             ←メンバー変数              |
      |               |    vvv:                                              |
      |               |      - array:                                        |
      |               |          - item1: value   ←メンバー変数              |
      |               |            item2:         ←メンバー変数              |
      |               |                                                      |
      |               | 多段変数を定義したテンプレートは、Ansible-LegacyRole\|
      |               | でしか使用できません。                               |
      |               |                                                      |
      |               | 同名の変数をdefault変数定義ファイルなどに定義\       |
      |               | している場合は、変数構造を合わせる必要があります。変\|
      |               | 数構造が一致していない場合は登録でエラーとなります。 |
      +---------------+------------------------------------------------------+
      | グ\           | 具体値は省略可能です。                               |
      | ローバル変数  |                                                      |
      |               | e.g.)                                                |
      |               |                                                      |
      |               | .. code-block:: yaml                                 |
      |               |                                                      |
      |               |    GBL_xxx: vaule                                    |
      |               |    GBL_xxx_2:                                        |
      |               |                                                      |
      +---------------+------------------------------------------------------+
      | ITA独自変数   | 変数の定義は不要です。                               |
      +---------------+------------------------------------------------------+

.. tip:: | 各変数名についての補足
    | vvv: 255バイト以内の半角英数字とアンダースコア（ _ ）
    | xxx: 251バイト以内の半角英数字とアンダースコア（ _ ）
    | メンバー変数は、下記の7文字を除くascii文字(0x20～0x7e)が使用出来ます。
    | " . [ ] ' \\ :
    | 尚、コーテーションで囲ないと変数名の先頭に使用出来ない文字がいくつかあります。
    | 詳細は、Ansible公式ドキュメントのYaml syntaxを参照してください。

.. include:: ../../include/ansible_option_template_list_legacy_example.rst

.. include:: ../../include/ansible_option_template_list_pioneer_example.rst

.. _ansible_common_unmanaged_var_list:

管理対象外変数リスト
--------------------

#. | 「 :ref:`ansible_common_var_listup` 」で抜出した変数で、 :menuselection:`各モード --> 代入値自動登録設定` の :menuselection:`Movement名:変数名` に表示したくない変数のメンテナンス（参照/更新/廃止/復活）を行います。
   | ITAインストール時にansibleマジック変数が登録されます。

   .. figure:: /images/ja/ansible_common/unmanaged_variables/unmanaged_var_list.png
      :width: 800px
      :alt: サブメニュー画面（管理対象外変数リスト）

      サブメニュー画面（管理対象外変数リスト）

#. | :guilabel:`登録` ボタンより、管理対象外変数の登録を行います。

   .. figure:: /images/ja/ansible_common/unmanaged_variables/unmanaged_var_list.gif
      :width: 800px
      :alt: 登録画面（管理対象外変数リスト）

      登録画面（管理対象外変数リスト）

#. | 登録画面の項目一覧は以下のとおりです。

   .. list-table:: 登録画面項目一覧（管理対象外変数リスト）
      :widths: 30 120 30 30 30
      :header-rows: 1
      :align: left

      * - 項目
        - 注意事項
        - 入力必須
        - 入力方法
        - 制約事項
      * - 項番
        - | 登録時に自動採番した36桁の文字列が表示されます。
        - ー 
        - 自動入力
        - ー 
      * - 変数名
        - |  :menuselection:`各モード --> 代入値自動登録設定` の :menuselection:`Movement名:変数名` に表示したくない変数名を入力します。
          | 変数名は正規表現で記載できます。
          | e.g.) \ansible_\*  \*:ワイルドカード
          |       \ansible_\[0\-9a\-zA\-Z]\*
        - 〇
        - 手動入力
        - 最大長255バイト
      * - 備考
        - 自由記述欄です。
        - ー
        - 手動入力
        - 最大長4000バイト

付録
====

.. _ansible_common_backyard_content:

BackYardコンテンツ
------------------


.. _ansible_common_aac_sync:

Ansible Automation Controllerデータ同期
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    
| :menuselection:`Ansible共通 --> インターフェース情報` の :menuselection:`実行エンジン` で「Ansible Automation Controller」を選択している場合、Ansible Automation Controllerに登録されているリソースを取得します。

.. list-table:: Ansible Automation Controllerから取得するリソースと使用用途
   :widths: 10 50
   :header-rows: 1
   :align: left

   * - リソース
     - 用途
   * - 組織名
     - | :menuselection:`Ansible共通 --> インターフェース情報` の :menuselection:`組織名` のリスト選択で使用されます。
       | :menuselection:`Ansible共通 --> インターフェース情報` の :menuselection:`認証トークン` で入力しているユーザが利用可能な組織名がリストに表示されます。
   * - インスタンスグループ
     - | :menuselection:`Ansible共通 --> 機器一覧` の :menuselection:`インスタンスグループ` のリスト選択で使用されます。
       |  :menuselection:`Ansible共通 --> インターフェース情報` の :menuselection:`組織名` で選択している組織が利用可能なインスタンスグループがリストに表示されます。
   * - 実行環境
     - | :menuselection:`各モード --> Movement一覧` の :menuselection:`実行環境` のリスト選択で使用されます。
       | :menuselection:`Ansible共通 --> インターフェース情報` の :menuselection:`組織名` で選択している組織が利用可能な実行環境がリストに表示されます。


.. _ansible_common_inventory_file:

ITAが作成するインベントリファイル
----------------------------------

| ITAが作成するインベントリファイルについて説明します。
| ITAが作成するインベントリファイルを以下に示します。

.. code-block:: yaml

   all:
     children:
       hostgroups:
         hosts:
           Inventory_host: 
             Inventory_host_parameters:
             Inventory_host_option_parameters:


| Inventory_hostには :menuselection:`Ansible共通 --> 機器一覧` の :menuselection:`ホスト名` を設定します。
| Inventory_host_option_parametersには :menuselection:`Ansible共通 --> 機器一覧` の :menuselection:`インベントリファイル追加オプション` を設定します。
| Inventory_host_parametersに設定するパラメータを以下に示します。
| 各設定値に対応する項目が未入力のパラメータは、Inventory_host_parametersに設定しません。


.. table::   Inventory_host_parametersに設定するパラメータ一覧
   :widths: 30 20 20 20 20 20 50
   :align: left

   +-------------------------------+-----------------------+------------------------+------------------------+------------------------+-----------------------+-----------------------------------------------------------------------------------------------------------------------------+
   | パラメータ名                  | :menuselection:`Ansible共通 --> 機器一覧` の :menuselection:`認証方式`                                                   | 設定値                                                                                                                      |
   +                               +-----------------------+------------------------+------------------------+------------------------+-----------------------+                                                                                                                             +
   |                               | パスワード認証        | 鍵認証                 | 鍵認証                 | 鍵認証                 | パスワード認証        |                                                                                                                             |
   |                               |                       |                        |                        |                        |                       |                                                                                                                             |
   |                               |                       | （パスフレーズなし）   | （パスフレーズあり）   | （鍵交換済み）         | 認証（winrm）         |                                                                                                                             |
   +===============================+=======================+========================+========================+========================+=======================+=============================================================================================================================+
   | ansible_host                  | 〇                    | 〇                     | 〇                     | 〇                     | 〇                    | :menuselection:`Ansible共通 --> 機器一覧` の :menuselection:`DNSホスト` または :menuselection:`DNSホストIPアドレス`         |
   |                               |                       |                        |                        |                        |                       | :menuselection:`各モード --> Movement一覧` の :menuselection:`ホスト指定形式` で選択されている内容にで決まります。          |
   +-------------------------------+-----------------------+------------------------+------------------------+------------------------+-----------------------+-----------------------------------------------------------------------------------------------------------------------------+
   | ansible_user                  | 〇                    | 〇                     | 〇                     | 〇                     | 〇                    | :menuselection:`Ansible共通 --> 機器一覧` の :menuselection:`ログインユーザ`                                                |
   +-------------------------------+-----------------------+------------------------+------------------------+------------------------+-----------------------+-----------------------------------------------------------------------------------------------------------------------------+
   | ansible_password              | 〇                    |                        |                        |                        | 〇                    | :menuselection:`Ansible共通 --> 機器一覧` の :menuselection:`ログインパスワード`                                            |
   +-------------------------------+-----------------------+------------------------+------------------------+------------------------+-----------------------+-----------------------------------------------------------------------------------------------------------------------------+
   | ansible_ssh_private_key_file  |                       | 〇                     | 〇                     |                        |                       | :menuselection:`Ansible共通 --> 機器一覧` の :menuselection:`ssh秘密鍵ファイル`                                             |
   +-------------------------------+-----------------------+------------------------+------------------------+------------------------+-----------------------+-----------------------------------------------------------------------------------------------------------------------------+
   | ansible_ssh_extra_args        | 〇                    | 〇                     | 〇                     | 〇                     |                       | :menuselection:`Ansible共通 --> 機器一覧` の :menuselection:`接続オプション`                                                |
   +-------------------------------+-----------------------+------------------------+------------------------+------------------------+-----------------------+-----------------------------------------------------------------------------------------------------------------------------+
   | ansible_connection:           |                       |                        |                        |                        | 〇                    | winrm                                                                                                                       |
   +-------------------------------+-----------------------+------------------------+------------------------+------------------------+-----------------------+-----------------------------------------------------------------------------------------------------------------------------+
   | ansible_port                  |                       |                        |                        |                        | 〇                    | :menuselection:`Ansible共通 --> 機器一覧` の :menuselection:`WinRM接続情報 --> ポート番号`                                  |
   +-------------------------------+-----------------------+------------------------+------------------------+------------------------+-----------------------+-----------------------------------------------------------------------------------------------------------------------------+
   | ansible_winrm_ca_trust_path   |                       |                        |                        |                        | 〇                    | :menuselection:`Ansible共通 --> 機器一覧` の :menuselection:`WinRM接続情報 --> サーバ証明書`                                |
   +-------------------------------+-----------------------+------------------------+------------------------+------------------------+-----------------------+-----------------------------------------------------------------------------------------------------------------------------+

.. tip:: | 〇: 設定対象
 
 
.. _ansible_common_option_parameter_list:

オプションパラメータ一覧
------------------------

.. include:: ../../include/ansible_option_option_parameter_list.rst


.. _ansible_common_aac_resources_list:

実行時データ削除で削除されるデータリソース
-------------------------------------------

.. include:: ../../include/ansible_option_data-resources-deleted.rst


.. _ansible_common_ita_org_var_ipoint_note:

Ansible Automation ControllerでITA独自変数を利用する場合の留意事項
--------------------------------------------------------------------------------------------------------------------

.. include:: ../../include/ansible_option_using-ita-proprietary-variables-in-aac.rst

